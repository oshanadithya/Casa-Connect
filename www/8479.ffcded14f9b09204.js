"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8479],{8479:(T,p,l)=>{l.r(p),l.d(p,{ChatPageModule:()=>Z});var g=l(6814),d=l(95),a=l(7311),u=l(2129),h=l(5861),m=l(7398),t=l(6689),f=l(1786),C=l(2014),b=l(7613);let M=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-chat-box"]],inputs:{chat:"chat",current_user_id:"current_user_id"},decls:9,vars:9,consts:[["lines","none"],[1,"ion-text-wrap",3,"slot"],["name","checkmark-done-outlet",3,"color"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-item",0)(1,"ion-label",1)(2,"ion-text"),t._uU(3),t.qZA(),t.TgZ(4,"ion-note")(5,"small"),t._uU(6),t.ALo(7,"date"),t.qZA(),t._UZ(8,"ion-icon",2),t.qZA()()()),2&e&&(t.Tol((null==n.chat?null:n.chat.sender)!=n.current_user_id?"sender":"user"),t.xp6(1),t.Q6J("slot",(null==n.chat?null:n.chat.sender)==n.current_user_id?"end":"start"),t.xp6(2),t.Oqu(null==n.chat?null:n.chat.message),t.xp6(3),t.Oqu(t.xi3(7,6,null==n.chat||null==n.chat.createdAt?null:n.chat.createdAt.toDate(),"HH:mm")),t.xp6(2),t.Q6J("color",(null==n.chat?null:n.chat.sender)==n.current_user_id?"light":"primary"))},dependencies:[a.gu,a.Ie,a.Q$,a.uN,a.yW,g.uU],styles:['ion-item[_ngcontent-%COMP%]{--background: transparent;--padding-start: 8px;--padding-end: 0px;--ion-safe-area-left: 0px;--min-height: 32px;--border-width: 0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{position:relative;border-radius:12px;padding:4px 8px;margin-top:12px;max-width:70%;min-width:50%}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]:after{content:"";width:52px;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:.75rem}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{position:absolute;display:flex;right:0;bottom:0;padding:4px 8px 4px 4px;line-height:16px}.user[_ngcontent-%COMP%]:after{content:"";position:absolute;border:0 solid transparent;border-bottom-color:transparent;border-bottom-style:solid;border-bottom-width:0px;border-bottom:9px solid var(--ion-color-primary);border-radius:20px 0;width:15px;height:30px;transform:rotate(50deg);bottom:0px;right:0px}.user[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{background-color:var(--ion-color-primary);color:#fff}.user[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}.user[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]:after{content:"";width:52px;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:.75rem}.sender[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{background-color:var(--ion-color-medium);color:#fff}.sender[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}.sender[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]:after{content:"";width:52px;height:12px;display:inline-block;vertical-align:top;visibility:hidden;font-size:.75rem}']}),o})();function P(o,i){if(1&o&&(t.TgZ(0,"ion-item-group",11),t._UZ(1,"app-chat-box",12),t.qZA()),2&o){const e=i.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("chat",e)("current_user_id",n.chatService.currentUserId)}}function v(o,i){if(1&o&&(t.TgZ(0,"ion-list",9),t.YNc(1,P,2,2,"ion-item-group",10),t.qZA()),2&o){const e=i.ngIf;t.xp6(1),t.Q6J("ngForOf",e)}}function _(o,i){if(1&o){const e=t.EpF();t.TgZ(0,"ion-fab-button",13),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.sendMessage())}),t._UZ(1,"ion-icon",14),t.qZA()}}function x(o,i){1&o&&(t.TgZ(0,"ion-fab-button",15),t._UZ(1,"ion-spinner",16),t.qZA())}const O=[{path:"",component:(()=>{class o{constructor(e,n,s,r,c){this.route=e,this.navCtrl=n,this.chatService=s,this.storage=r,this.api=c,this.currentUserId=1,this.model={icon:"chatbubble-outline",title:"No Conversation",color:"danger"}}ngOnInit(){var e=this;return(0,h.Z)(function*(){const n=e.route.snapshot.queryParams;console.log("data",n),null!=n&&n.name&&(e.name=n.name);const s=e.route.snapshot.paramMap.get("id");console.log("chat id :",s),s?(e.id=s,e.gmailid=yield e.storage.get("gmailid"),e.appleid=yield e.storage.get("appleid"),console.log("gmailid :",e.gmailid),e.gmailid?(e.selectedChatRoomMessages=e.api.collectionDataQuery(`chats/${e.id}/messages`,e.api.orderByQuery("createdAt","desc")).pipe((0,m.U)(r=>r.reverse())),e.chats=e.selectedChatRoomMessages,console.log("gmailid chat:",e.chats)):e.appleid?(e.selectedChatRoomMessages=e.api.collectionDataQuery(`chats/${e.id}/messages`,e.api.orderByQuery("createdAt","desc")).pipe((0,m.U)(r=>r.reverse())),e.chats=e.selectedChatRoomMessages,console.log("appleid chat:",e.chats)):(e.chatService.getChatRoomsMessages(e.id),e.chats=e.chatService.selectedChatRoomMessages,console.log("emailid chat:",e.chats))):e.navCtrl.back()})()}ngAfterViewChecked(){this.scrollToBottom()}scrollToBottom(){console.log("scroll bottom"),this.chats&&this.content.scrollToBottom(500)}sendMessage(){var e=this;return(0,h.Z)(function*(){if(e.gmailid){var n;if(!e.message||""==(null===(n=e.message)||void 0===n?void 0:n.trim()))return;e.isLoading=!0;const c={message:e.message,sender:e.gmailid,createdAt:new Date};e.id&&(yield e.api.addDocument(`chats/${e.id}/messages`,c)),e.message="",e.isLoading=!1,e.scrollToBottom()}else if(e.appleid){var s;if(!e.message||""==(null===(s=e.message)||void 0===s?void 0:s.trim()))return;e.isLoading=!0;const c={message:e.message,sender:e.appleid,createdAt:new Date};e.id&&(yield e.api.addDocument(`chats/${e.id}/messages`,c)),e.message="",e.isLoading=!1,e.scrollToBottom()}else{var r;if(!e.message||""==(null===(r=e.message)||void 0===r?void 0:r.trim()))return;try{e.isLoading=!0,yield e.chatService.sendMessage(e.id,e.message),e.message="",e.isLoading=!1,e.scrollToBottom()}catch(c){e.isLoading=!1,console.log(c)}}})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.gz),t.Y36(a.SH),t.Y36(f.a),t.Y36(C.K),t.Y36(b.s))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-chat"]],viewQuery:function(e,n){if(1&e&&t.Gf(a.W2,5),2&e){let s;t.iGM(s=t.CRH())&&(n.content=s.first)}},decls:15,vars:8,consts:[["translcant","true"],["slot","start"],["defaultHref","menu/home"],[1,"ion-padding",3,"scrollEvents"],["lines","none",4,"ngIf"],["autoGrow","","rows","1","placeholder","Send message",1,"ion-text-center",3,"ngModel","ngModelChange"],["slot","end"],["size","small",3,"click",4,"ngIf"],["size","small",4,"ngIf"],["lines","none"],["class","chats-group",4,"ngFor","ngForOf"],[1,"chats-group"],[3,"chat","current_user_id"],["size","small",3,"click"],["name","send"],["size","small"],["name","crescent","color","white"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-content",3),t.YNc(7,v,2,1,"ion-list",4),t.ALo(8,"async"),t.qZA(),t.TgZ(9,"ion-footer")(10,"ion-toolbar")(11,"ion-textarea",5),t.NdJ("ngModelChange",function(r){return n.message=r}),t.qZA(),t.TgZ(12,"ion-buttons",6),t.YNc(13,_,2,0,"ion-fab-button",7),t.YNc(14,x,2,0,"ion-fab-button",8),t.qZA()()()),2&e&&(t.xp6(5),t.Oqu(n.name),t.xp6(1),t.Q6J("scrollEvents",!0),t.xp6(1),t.Q6J("ngIf",t.lcZ(8,6,n.chats)),t.xp6(4),t.Q6J("ngModel",n.message),t.xp6(2),t.Q6J("ngIf",!n.isLoading),t.xp6(1),t.Q6J("ngIf",!n.isLoading))},dependencies:[g.sg,g.O5,d.JJ,d.On,a.oU,a.Sm,a.W2,a.W4,a.fr,a.Gu,a.gu,a.Ub,a.q_,a.PQ,a.g2,a.wd,a.sr,a.j9,a.cs,M,g.Ov]}),o})()}];let y=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.Bz.forChild(O),u.Bz]}),o})(),Z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[g.ez,d.u5,a.Pc,y]}),o})()}}]);