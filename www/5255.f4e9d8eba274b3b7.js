"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5255],{5255:(LI,Zu,z)=>{z.r(Zu),z.d(Zu,{LoginPageModule:()=>MI});var Yu=z(6814),Se=z(95),re=z(7311),xi=z(2129),p=z(5861),Di=z(6346),yf=z(1450),Ce=z(4303),Ni=z(4537),Ue=z(7879),G=z(9058),ge=z(1554);const Ju="@firebase/firestore";class le{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}le.UNAUTHENTICATED=new le(null),le.GOOGLE_CREDENTIALS=new le("google-credentials-uid"),le.FIRST_PARTY=new le("first-party-uid"),le.MOCK_USER=new le("mock-user");let Ft="10.0.0";const Ye=new Ue.Yd("@firebase/firestore");function Oi(){return Ye.logLevel}function I(r,...e){if(Ye.logLevel<=Ue.in.DEBUG){const t=e.map(Mi);Ye.debug(`Firestore (${Ft}): ${r}`,...t)}}function X(r,...e){if(Ye.logLevel<=Ue.in.ERROR){const t=e.map(Mi);Ye.error(`Firestore (${Ft}): ${r}`,...t)}}function Ve(r,...e){if(Ye.logLevel<=Ue.in.WARN){const t=e.map(Mi);Ye.warn(`Firestore (${Ft}): ${r}`,...t)}}function Mi(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function P(r="Unexpected state"){const e=`FIRESTORE (${Ft}) INTERNAL ASSERTION FAILED: `+r;throw X(e),new Error(e)}function b(r,e){r||P()}function w(r,e){return r}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class g extends G.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ae{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Xu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class If{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(le.UNAUTHENTICATED))}shutdown(){}}class vf{constructor(e){this.t=e,this.currentUser=le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let o=new ae;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ae,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield s(n.currentUser)}))},u=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ae)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(b("string"==typeof n.accessToken),new Xu(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(null===e||"string"==typeof e),new le(e)}}class Ef{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=le.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Af{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Ef(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(le.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ec{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Rf{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=s=>{null!=s.error&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b("string"==typeof t.token),this.R=t.token,new ec(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function wf(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class tc{static V(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=wf(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function x(r,e){return r<e?-1:r>e?1:0}function Ut(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}class H{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new g(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new g(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new g(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new g(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return H.fromMillis(Date.now())}static fromDate(e){return H.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new H(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?x(this.nanoseconds,e.nanoseconds):x(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class S{constructor(e){this.timestamp=e}static fromTimestamp(e){return new S(e)}static min(){return new S(new H(0,0))}static max(){return new S(new H(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class In{constructor(e,t,n){void 0===t?t=0:t>e.length&&P(),void 0===n?n=e.length-t:n>e.length-t&&P(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===In.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof In?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class L extends In{construct(e,t,n){return new L(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new g(m.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new L(t)}static emptyPath(){return new L([])}}const Pf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ee extends In{construct(e,t,n){return new ee(e,t,n)}static isValidIdentifier(e){return Pf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ee.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ee(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new g(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;i<e.length;){const a=e[i];if("\\"===a){if(i+1===e.length)throw new g(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new g(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else"`"===a?(o=!o,i++):"."!==a||o?(n+=a,i++):(s(),i++)}if(s(),o)throw new g(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ee(t)}static emptyPath(){return new ee([])}}class R{constructor(e){this.path=e}static fromPath(e){return new R(L.fromString(e))}static fromName(e){return new R(L.fromString(e).popFirst(5))}static empty(){return new R(L.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===L.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return L.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new R(new L(e.slice()))}}class we{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new we(S.min(),R.empty(),-1)}static max(){return new we(S.max(),R.empty(),-1)}}function Fi(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=R.comparator(r.documentKey,e.documentKey),0!==t?t:x(r.largestBatchId,e.largestBatchId))}const sc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Je(r){return Ui.apply(this,arguments)}function Ui(){return(Ui=(0,p.Z)(function*(r){if(r.code!==m.FAILED_PRECONDITION||r.message!==sc)throw r;I("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class _{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&P(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new _((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof _?t:_.resolve(t)}catch(t){return _.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):_.reject(t)}static resolve(e){return new _((t,n)=>{t(e)})}static reject(e){return new _((t,n)=>{n(e)})}static waitFor(e){return new _((t,n)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>n(u))}),o=!0,s===i&&t()})}static or(e){let t=_.resolve(!1);for(const n of e)t=t.next(i=>i?_.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new _((n,i)=>{const s=e.length,o=new Array(s);let a=0;for(let u=0;u<s;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&n(o)},l=>i(l))}})}static doWhile(e,t){return new _((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function Xe(r){return"IndexedDbTransactionError"===r.name}let Pe=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.oe(i),this._e=i=>n.writeSequenceNumber(i))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}return r.ae=-1,r})();function En(r){return null==r}function An(r){return 0===r&&1/r==-1/0}function _c(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function et(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function mc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class K{constructor(e,t){this.comparator=e,this.root=t||_e.EMPTY}insert(e,t){return new K(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,_e.BLACK,null,null))}remove(e){return new K(this.comparator,this.root.remove(e,this.comparator).copy(null,null,_e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Tr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Tr(this.root,e,this.comparator,!1)}getReverseIterator(){return new Tr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Tr(this.root,e,this.comparator,!0)}}class Tr{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class _e{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:_e.RED,this.left=null!=i?i:_e.EMPTY,this.right=null!=s?s:_e.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new _e(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _e.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return _e.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,_e.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,_e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw P();const e=this.left.check();if(e!==this.right.check())throw P();return e+(this.isRed()?0:1)}}_e.EMPTY=null,_e.RED=!0,_e.BLACK=!1,_e.EMPTY=new class{constructor(){this.size=0}get key(){throw P()}get value(){throw P()}get color(){throw P()}get left(){throw P()}get right(){throw P()}copy(e,t,n,i,s){return this}insert(e,t,n){return new _e(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class W{constructor(e){this.comparator=e,this.data=new K(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new pc(this.data.getIterator())}getIteratorFrom(e){return new pc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof W)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new W(this.comparator);return t.data=e,t}}class pc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ee{constructor(e){this.fields=e,e.sort(ee.comparator)}static empty(){return new Ee([])}unionWith(e){let t=new W(ee.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ee(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ut(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class gc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ue{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new gc("Invalid base64 string: "+s):s}}(e);return new ue(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new ue(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return x(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ue.EMPTY_BYTE_STRING=new ue("");const Jf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tt(r){if(b(!!r),"string"==typeof r){let e=0;const t=Jf.exec(r);if(b(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Y(r.seconds),nanos:Y(r.nanos)}}function Y(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Ge(r){return"string"==typeof r?ue.fromBase64String(r):ue.fromUint8Array(r)}function vr(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Er(r){const e=r.mapValue.fields.__previous_value__;return vr(e)?Er(e):e}function Rn(r){const e=tt(r.mapValue.fields.__local_write_time__.timestampValue);return new H(e.seconds,e.nanos)}class Xf{constructor(e,t,n,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class It{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new It("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof It&&e.projectId===this.projectId&&e.database===this.database}}const nt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function rt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?vr(r)?4:vc(r)?9007199254740991:10:P()}function Ne(r,e){if(r===e)return!0;const t=rt(r);if(t!==rt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Rn(r).isEqual(Rn(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=tt(i.timestampValue),a=tt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,Ge(r.bytesValue).isEqual(Ge(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Y(i.geoPointValue.latitude)===Y(s.geoPointValue.latitude)&&Y(i.geoPointValue.longitude)===Y(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Y(i.integerValue)===Y(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Y(i.doubleValue),a=Y(s.doubleValue);return o===a?An(o)===An(a):isNaN(o)&&isNaN(a)}return!1}(r,e);case 9:return Ut(r.arrayValue.values||[],e.arrayValue.values||[],Ne);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(_c(o)!==_c(a))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(void 0===a[u]||!Ne(o[u],a[u])))return!1;return!0}(r,e);default:return P()}var s}function wn(r,e){return void 0!==(r.values||[]).find(t=>Ne(t,e))}function it(r,e){if(r===e)return 0;const t=rt(r),n=rt(e);if(t!==n)return x(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return x(r.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Y(s.integerValue||s.doubleValue),u=Y(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(r,e);case 3:return yc(r.timestampValue,e.timestampValue);case 4:return yc(Rn(r),Rn(e));case 5:return x(r.stringValue,e.stringValue);case 6:return function(s,o){const a=Ge(s),u=Ge(o);return a.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){const l=x(a[c],u[c]);if(0!==l)return l}return x(a.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,o){const a=x(Y(s.latitude),Y(o.latitude));return 0!==a?a:x(Y(s.longitude),Y(o.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){const l=it(a[c],u[c]);if(l)return l}return x(a.length,u.length)}(r.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===nt.mapValue&&o===nt.mapValue)return 0;if(s===nt.mapValue)return 1;if(o===nt.mapValue)return-1;const a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let d=0;d<u.length&&d<l.length;++d){const h=x(u[d],l[d]);if(0!==h)return h;const f=it(a[u[d]],c[l[d]]);if(0!==f)return f}return x(u.length,l.length)}(r.mapValue,e.mapValue);default:throw P()}}function yc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return x(r,e);const t=tt(r),n=tt(e),i=x(t.seconds,n.seconds);return 0!==i?i:x(t.nanos,n.nanos)}function qt(r){return Bi(r)}function Bi(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=tt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Ge(r.bytesValue).toBase64():"referenceValue"in r?R.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=Bi(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of n)s?s=!1:i+=",",i+=`${o}:${Bi(t.fields[o])}`;return i+"}"}(r.mapValue):P()}function zi(r){return!!r&&"integerValue"in r}function Pn(r){return!!r&&"arrayValue"in r}function wr(r){return!!r&&"mapValue"in r}function bn(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return et(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=bn(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=bn(r.arrayValue.values[t]);return e}return Object.assign({},r)}function vc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}class me{constructor(e){this.value=e}static empty(){return new me({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!wr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bn(t)}setAll(e){let t=ee.emptyPath(),n={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,n,i),n={},i=[],t=a.popLast()}o?n[a.lastSegment()]=bn(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());wr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ne(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];wr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){et(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new me(bn(this.value))}}function Rc(r){const e=[];return et(r.fields,(t,n)=>{const i=new ee([t]);if(wr(n)){const s=Rc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ee(e)}class ${constructor(e,t,n,i,s,o,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new $(e,0,S.min(),S.min(),S.min(),me.empty(),0)}static newFoundDocument(e,t,n,i){return new $(e,1,t,S.min(),n,i,0)}static newNoDocument(e,t){return new $(e,2,t,S.min(),S.min(),me.empty(),0)}static newUnknownDocument(e,t){return new $(e,3,t,S.min(),S.min(),me.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(S.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=me.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=me.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=S.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof $&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class st{constructor(e,t){this.position=e,this.inclusive=t}}function wc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],o=r.position[i];if(n=s.field.isKeyField()?R.comparator(R.fromName(o.referenceValue),t.key):it(o,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function Pc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ne(r.position[t],e.position[t]))return!1;return!0}class Bt{constructor(e,t="asc"){this.field=e,this.dir=t}}function n_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class bc{}class O extends bc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new r_(e,t,n):"array-contains"===t?new o_(e,n):"in"===t?new Dc(e,n):"not-in"===t?new a_(e,n):"array-contains-any"===t?new u_(e,n):new O(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new i_(e,n):new s_(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(it(t,this.value)):null!==t&&rt(this.value)===rt(t)&&this.matchesComparison(it(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return P()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class B extends bc{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new B(e,t)}matches(e){return zt(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.le(t=>t.isInequality());return null!==e?e.field:null}le(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function zt(r){return"and"===r.op}function Wi(r){return function Sc(r){for(const e of r.filters)if(e instanceof B)return!1;return!0}(r)&&zt(r)}function $i(r){if(r instanceof O)return r.field.canonicalString()+r.op.toString()+qt(r.value);if(Wi(r))return r.filters.map(e=>$i(e)).join(",");{const e=r.filters.map(t=>$i(t)).join(",");return`${r.op}(${e})`}}function kc(r,e){return r instanceof O?(n=r,(i=e)instanceof O&&n.op===i.op&&n.field.isEqual(i.field)&&Ne(n.value,i.value)):r instanceof B?function(n,i){return i instanceof B&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,o,a)=>s&&kc(o,i.filters[a]),!0)}(r,e):void P();var n,i}function Vc(r){return r instanceof O?`${(t=r).field.canonicalString()} ${t.op} ${qt(t.value)}`:r instanceof B?function(t){return t.op.toString()+" {"+t.getFilters().map(Vc).join(" ,")+"}"}(r):"Filter";var t}class r_ extends O{constructor(e,t,n){super(e,t,n),this.key=R.fromName(n.referenceValue)}matches(e){const t=R.comparator(e.key,this.key);return this.matchesComparison(t)}}class i_ extends O{constructor(e,t){super(e,"in",t),this.keys=xc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class s_ extends O{constructor(e,t){super(e,"not-in",t),this.keys=xc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>R.fromName(n.referenceValue))}class o_ extends O{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Pn(t)&&wn(t.arrayValue,this.value)}}class Dc extends O{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&wn(this.value.arrayValue,t)}}class a_ extends O{constructor(e,t){super(e,"not-in",t)}matches(e){if(wn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!wn(this.value.arrayValue,t)}}class u_ extends O{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Pn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>wn(this.value.arrayValue,n))}}class c_{constructor(e,t=null,n=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.he=null}}function ji(r,e=null,t=[],n=[],i=null,s=null,o=null){return new c_(r,e,t,n,i,s,o)}function vt(r){const e=w(r);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>$i(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),En(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>qt(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>qt(n)).join(",")),e.he=t}return e.he}function Sn(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!n_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!kc(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!Pc(r.startAt,e.startAt)&&Pc(r.endAt,e.endAt)}class qe{constructor(e,t=null,n=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.Pe=null,this.Ie=null}}function Lc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Et(r){const e=w(r);if(null===e.Pe){e.Pe=[];const t=function Sr(r){for(const e of r.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function Qi(r){return r.explicitOrderBy.length>0?r.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.Pe.push(new Bt(t)),e.Pe.push(new Bt(ee.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.Pe.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new Bt(ee.keyField(),s))}}}return e.Pe}function ve(r){const e=w(r);if(!e.Ie)if("F"===e.limitType)e.Ie=ji(e.path,e.collectionGroup,Et(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Et(e))t.push(new Bt(s.field,"desc"===s.dir?"asc":"desc"));const n=e.endAt?new st(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new st(e.startAt.position,e.startAt.inclusive):null;e.Ie=ji(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.Ie}function kr(r,e,t){return new qe(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function kn(r,e){return Sn(ve(r),ve(e))&&r.limitType===e.limitType}function Fc(r){return`${vt(ve(r))}|lt:${r.limitType}`}function Yi(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Vc(i)).join(", ")}]`),En(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(o=i).field.canonicalString()} (${o.dir})`;var o}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>qt(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>qt(i)).join(",")),`Target(${n})`}(ve(r))}; limitType=${r.limitType})`}function Cn(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):R.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of Et(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(o,a,u){const c=wc(o,a,u);return o.inclusive?c<=0:c<0}(n.startAt,Et(n),i)||n.endAt&&!function(o,a,u){const c=wc(o,a,u);return o.inclusive?c>=0:c>0}(n.endAt,Et(n),i)));var n,i}function l_(r,e,t){const n=r.field.isKeyField()?R.comparator(e.key,t.key):function(s,o,a){const u=o.data.field(s),c=a.data.field(s);return null!==u&&null!==c?it(u,c):P()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return P()}}class Be{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){et(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return mc(this.inner)}size(){return this.innerSize}}const d_=new K(R.comparator);function Ae(){return d_}const qc=new K(R.comparator);function Vn(...r){let e=qc;for(const t of r)e=e.insert(t.key,t);return e}function Bc(r){let e=qc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function Oe(){return xn()}function zc(){return xn()}function xn(){return new Be(r=>r.toString(),(r,e)=>r.isEqual(e))}const h_=new K(R.comparator),f_=new W(R.comparator);function D(...r){let e=f_;for(const t of r)e=e.add(t);return e}const __=new W(x);function Kc(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:An(e)?"-0":e}}function Wc(r){return{integerValue:""+r}}function $c(r,e){return function ac(r){return"number"==typeof r&&Number.isInteger(r)&&!An(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}(e)?Wc(e):Kc(r,e)}class Cr{constructor(){this._=void 0}}function m_(r,e,t){return r instanceof Wt?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&vr(s)&&(s=Er(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):r instanceof At?Qc(r,e):r instanceof Rt?Hc(r,e):function(i,s){const o=jc(i,s),a=Zc(o)+Zc(i.Te);return zi(o)&&zi(i.Te)?Wc(a):Kc(i.serializer,a)}(r,e)}function p_(r,e,t){return r instanceof At?Qc(r,e):r instanceof Rt?Hc(r,e):t}function jc(r,e){return r instanceof $t?zi(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Wt extends Cr{}class At extends Cr{constructor(e){super(),this.elements=e}}function Qc(r,e){const t=Yc(e);for(const n of r.elements)t.some(i=>Ne(i,n))||t.push(n);return{arrayValue:{values:t}}}class Rt extends Cr{constructor(e){super(),this.elements=e}}function Hc(r,e){let t=Yc(e);for(const n of r.elements)t=t.filter(i=>!Ne(i,n));return{arrayValue:{values:t}}}class $t extends Cr{constructor(e,t){super(),this.serializer=e,this.Te=t}}function Zc(r){return Y(r.integerValue||r.doubleValue)}function Yc(r){return Pn(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class y_{constructor(e,t){this.version=e,this.transformResults=t}}class Q{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Q}static exists(e){return new Q(void 0,e)}static updateTime(e){return new Q(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Vr(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class xr{}function Jc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Qt(r.key,Q.none()):new jt(r.key,r.data,Q.none());{const t=r.data,n=me.empty();let i=new W(ee.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);null===o&&s.length>1&&(s=s.popLast(),o=t.field(s)),null===o?n.delete(s):n.set(s,o),i=i.add(s)}return new ze(r.key,n,new Ee(i.toArray()),Q.none())}}function I_(r,e,t){r instanceof jt?function(i,s,o){const a=i.value.clone(),u=tl(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(r,e,t):r instanceof ze?function(i,s,o){if(!Vr(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=tl(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(el(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Nn(r,e,t,n){return r instanceof jt?function(s,o,a,u){if(!Vr(s.precondition,o))return a;const c=s.value.clone(),l=nl(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(r,e,t,n):r instanceof ze?function(s,o,a,u){if(!Vr(s.precondition,o))return a;const c=nl(s.fieldTransforms,u,o),l=o.data;return l.setAll(el(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null===a?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(r,e,t,n):(a=t,Vr(r.precondition,o=e)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a);var o,a}function T_(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=jc(n.transform,i||null);null!=s&&(null===t&&(t=me.empty()),t.set(n.field,s))}return t||null}function Xc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&Ut(n,i,(s,o)=>function g_(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof At&&i instanceof At||n instanceof Rt&&i instanceof Rt?Ut(n.elements,i.elements,Ne):n instanceof $t&&i instanceof $t?Ne(n.Te,i.Te):n instanceof Wt&&i instanceof Wt);var n,i}(s,o))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class jt extends xr{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ze extends xr{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function el(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function tl(r,e,t){const n=new Map;b(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],o=s.transform,a=e.data.field(s.field);n.set(s.field,p_(o,a,t[i]))}return n}function nl(r,e,t){const n=new Map;for(const i of r){const s=i.transform,o=t.data.field(i.field);n.set(i.field,m_(s,o,e))}return n}class Qt extends xr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xi extends xr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class es{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&I_(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Nn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Nn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=zc();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const u=Jc(o,a);null!==u&&n.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(S.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),D())}isEqual(e){return this.batchId===e.batchId&&Ut(this.mutations,e.mutations,(t,n)=>Xc(t,n))&&Ut(this.baseMutations,e.baseMutations,(t,n)=>Xc(t,n))}}class ts{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){b(e.mutations.length===n.length);let i=h_;const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,n[o].version);return new ts(e,t,n,i)}}class ns{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}var ie,F;(F=ie||(ie={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS",new ge.z8([4294967295,4294967295],0);class S_{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ht(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function k_(r,e){return Ht(r,e.toTimestamp())}function te(r){return b(!!r),S.fromTimestamp(function(t){const n=tt(t);return new H(n.seconds,n.nanos)}(r))}function os(r,e){return(n=r,new L(["projects",n.projectId,"databases",n.database])).child("documents").child(e).canonicalString();var n}function Fn(r,e){return os(r.databaseId,e.path)}function ml(r){const e=function _l(r){const e=L.fromString(r);return b(function Al(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}(e)),e}(r);return 4===e.length?L.emptyPath():function pl(r){return b(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}(e)}function gl(r,e,t){return{name:Fn(r,e),fields:t.value.mapValue.fields}}function Tl(r){let e=ml(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){b(1===n);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(d){const h=vl(d);return h instanceof B&&Wi(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(h=>{return new Bt(Zt((T=h).field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction));var T}));let a=null;t.limit&&(a=function(d){let h;return h="object"==typeof d?d.value:d,En(h)?null:h}(t.limit));let u=null;var d;t.startAt&&(u=new st((d=t.startAt).values||[],!!d.before));let c=null;return t.endAt&&(c=function(d){return new st(d.values||[],!d.before)}(t.endAt)),function Mc(r,e,t,n,i,s,o,a){return new qe(r,e,t,n,i,s,o,a)}(e,i,o,s,a,"F",u,c)}function vl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=Zt(t.unaryFilter.field);return O.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=Zt(t.unaryFilter.field);return O.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Zt(t.unaryFilter.field);return O.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Zt(t.unaryFilter.field);return O.create(o,"!=",{nullValue:"NULL_VALUE"});default:return P()}}(r):void 0!==r.fieldFilter?O.create(Zt((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return P()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return B.create(t.compositeFilter.filters.map(n=>vl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return P()}}(t.compositeFilter.op))}(r):P();var t}function Zt(r){return ee.fromServerFormat(r.fieldPath)}function L_(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}class Rl{constructor(e){this.ct=e}}function ls(r){const e=Tl({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?kr(e,e.limit,"L"):e}class St{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Y(e.integerValue));else if("doubleValue"in e){const n=Y(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),An(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Ge(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?vc(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):P()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const i of Object.keys(n))this.Rt(i,t),this.It(n[i],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const i of n)this.It(i,t)}gt(e,t){this.Et(t,37),R.fromName(e).path.forEach(n=>{this.Et(t,60),this.St(n,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}St.bt=new St;class $_{constructor(){this.sn=new ps}addToCollectionParentIndex(e,t){return this.sn.add(t),_.resolve()}getCollectionParents(e,t){return _.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return _.resolve()}deleteFieldIndex(e,t){return _.resolve()}getDocumentsMatchingTarget(e,t){return _.resolve(null)}getIndexType(e,t){return _.resolve(0)}getFieldIndexes(e,t){return _.resolve([])}getNextCollectionGroupToUpdate(e){return _.resolve(null)}getMinOffset(e,t){return _.resolve(we.min())}getMinOffsetFromCollectionGroup(e,t){return _.resolve(we.min())}updateCollectionGroup(e,t,n){return _.resolve()}updateIndexEntries(e,t){return _.resolve()}}class ps{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new W(L.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new W(L.comparator)).toArray()}}new Uint8Array(0);class Ie{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ie(e,Ie.DEFAULT_COLLECTION_PERCENTILE,Ie.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Ie.DEFAULT_COLLECTION_PERCENTILE=10,Ie.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ie.DEFAULT=new Ie(41943040,Ie.DEFAULT_COLLECTION_PERCENTILE,Ie.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ie.DISABLED=new Ie(-1,0,0);class Ct{constructor(e){this.Mn=e}next(){return this.Mn+=2,this.Mn}static xn(){return new Ct(0)}static On(){return new Ct(-1)}}class J_{constructor(){this.changes=new Be(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?_.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class tm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Zl{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&Nn(n.mutation,i,Ee.empty(),H.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,D()).next(()=>n))}getLocalViewOfDocuments(e,t,n=D()){const i=Oe();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let o=Vn();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const n=Oe();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,D()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,n,i){let s=Ae();const o=xn(),a=xn();return t.forEach((u,c)=>{const l=n.get(c.key);i.has(c.key)&&(void 0===l||l.mutation instanceof ze)?s=s.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),Nn(l.mutation,c,l.mutation.getFieldMask(),H.now())):o.set(c.key,Ee.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var d;return a.set(c,new tm(l,null!==(d=o.get(c))&&void 0!==d?d:null))}),a))}recalculateAndSaveOverlays(e,t){const n=xn();let i=new K((o,a)=>o-a),s=D();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=n.get(u)||Ee.empty();l=a.applyToLocalView(c,l),n.set(u,l);const d=(i.get(a.batchId)||D()).add(u);i=i.insert(a.batchId,d)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,d=zc();l.forEach(h=>{if(!s.has(h)){const f=Jc(t.get(h),n.get(h));null!==f&&d.set(h,f),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return _.waitFor(o)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n){return R.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):function Hi(r){return null!==r.collectionGroup}(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var s}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):_.resolve(Oe());let a=-1,u=s;return o.next(c=>_.forEach(c,(l,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(l)?_.resolve():this.remoteDocumentCache.getEntry(e,l).next(h=>{u=u.insert(l,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,D())).next(l=>({batchId:a,changes:Bc(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new R(t)).next(n=>{let i=Vn();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const i=t.collectionGroup;let s=Vn();return this.indexManager.getCollectionParents(e,i).next(o=>_.forEach(o,a=>{const u=(l=t,d=a.child(i),new qe(d,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,d;return this.getDocumentsMatchingCollectionQuery(e,u,n).next(c=>{c.forEach((l,d)=>{s=s.insert(l,d)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i))).next(s=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,$.newInvalidDocument(c)))});let o=Vn();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&Nn(c.mutation,u,Ee.empty(),H.now()),Cn(t,u)&&(o=o.insert(a,u))}),o})}}class nm{constructor(e){this.serializer=e,this.ar=new Map,this.ur=new Map}getBundleMetadata(e,t){return _.resolve(this.ar.get(t))}saveBundleMetadata(e,t){return this.ar.set(t.id,{id:(i=t).id,version:i.version,createTime:te(i.createTime)}),_.resolve();var i}getNamedQuery(e,t){return _.resolve(this.ur.get(t))}saveNamedQuery(e,t){return this.ur.set(t.name,{name:(i=t).name,query:ls(i.bundledQuery),readTime:te(i.readTime)}),_.resolve();var i}}class rm{constructor(){this.overlays=new K(R.comparator),this.cr=new Map}getOverlay(e,t){return _.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Oe();return _.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),_.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.cr.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.cr.delete(n)),_.resolve()}getOverlaysForCollection(e,t,n){const i=Oe(),s=t.length+1,o=new R(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>n&&i.set(u.getKey(),u)}return _.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new K((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>n){let l=s.get(c.largestBatchId);null===l&&(l=Oe(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Oe(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return _.resolve(a)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const o=this.cr.get(i.largestBatchId).delete(n.key);this.cr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(n.key,new ns(t,n));let s=this.cr.get(t);void 0===s&&(s=D(),this.cr.set(t,s)),this.cr.set(t,s.add(n.key))}}class gs{constructor(){this.lr=new W(he.hr),this.Pr=new W(he.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(e,t){const n=new he(e,t);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Er(new he(e,t))}dr(e,t){e.forEach(n=>this.removeReference(n,t))}Ar(e){const t=new R(new L([])),n=new he(t,e),i=new he(t,e+1),s=[];return this.Pr.forEachInRange([n,i],o=>{this.Er(o),s.push(o.key)}),s}Rr(){this.lr.forEach(e=>this.Er(e))}Er(e){this.lr=this.lr.delete(e),this.Pr=this.Pr.delete(e)}Vr(e){const t=new R(new L([])),n=new he(t,e),i=new he(t,e+1);let s=D();return this.Pr.forEachInRange([n,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new he(e,0),n=this.lr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class he{constructor(e,t){this.key=e,this.mr=t}static hr(e,t){return R.comparator(e.key,t.key)||x(e.mr,t.mr)}static Ir(e,t){return x(e.mr,t.mr)||R.comparator(e.key,t.key)}}class im{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.gr=1,this.pr=new W(he.hr)}checkEmpty(e){return _.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.gr;this.gr++;const o=new es(s,t,n,i);this.mutationQueue.push(o);for(const a of i)this.pr=this.pr.add(new he(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return _.resolve(o)}lookupMutationBatch(e,t){return _.resolve(this.yr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.wr(t+1),s=i<0?0:i;return _.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(e){return _.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new he(t,0),i=new he(t,Number.POSITIVE_INFINITY),s=[];return this.pr.forEachInRange([n,i],o=>{const a=this.yr(o.mr);s.push(a)}),_.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new W(x);return t.forEach(i=>{const s=new he(i,0),o=new he(i,Number.POSITIVE_INFINITY);this.pr.forEachInRange([s,o],a=>{n=n.add(a.mr)})}),_.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;R.isDocumentKey(s)||(s=s.child(""));const o=new he(new R(s),0);let a=new W(x);return this.pr.forEachWhile(u=>{const c=u.key.path;return!!n.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.mr)),!0)},o),_.resolve(this.Sr(a))}Sr(e){const t=[];return e.forEach(n=>{const i=this.yr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){b(0===this.br(t.batchId,"removed")),this.mutationQueue.shift();let n=this.pr;return _.forEach(t.mutations,i=>{const s=new he(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.pr=n})}Cn(e){}containsKey(e,t){const n=new he(t,0),i=this.pr.firstAfterOrEqual(n);return _.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return _.resolve()}br(e,t){return this.wr(e)}wr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}yr(e){const t=this.wr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sm{constructor(e){this.Dr=e,this.docs=new K(R.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,o=this.Dr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return _.resolve(n?n.document.mutableCopy():$.newInvalidDocument(t))}getEntries(e,t){let n=Ae();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():$.newInvalidDocument(i))}),_.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Ae();const o=t.path,a=new R(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Fi(new we((r=l).readTime,r.key,-1),n)<=0||(i.has(l.key)||Cn(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}var r;return _.resolve(s)}getAllFromCollectionGroup(e,t,n,i){P()}vr(e,t){return _.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new om(this)}getSize(e){return _.resolve(this.size)}}class om extends J_{constructor(e){super(),this.sr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.sr.addEntry(e,i)):this.sr.removeEntry(n)}),_.waitFor(t)}getFromCache(e,t){return this.sr.getEntry(e,t)}getAllFromCache(e,t){return this.sr.getEntries(e,t)}}class am{constructor(e){this.persistence=e,this.Cr=new Be(t=>vt(t),Sn),this.lastRemoteSnapshotVersion=S.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new gs,this.targetCount=0,this.Or=Ct.xn()}forEachTarget(e,t){return this.Cr.forEach((n,i)=>t(i)),_.resolve()}getLastRemoteSnapshotVersion(e){return _.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _.resolve(this.Fr)}allocateTargetId(e){return this.highestTargetId=this.Or.next(),_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Fr&&(this.Fr=t),_.resolve()}Ln(e){this.Cr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Or=new Ct(t),this.highestTargetId=t),e.sequenceNumber>this.Fr&&(this.Fr=e.sequenceNumber)}addTargetData(e,t){return this.Ln(t),this.targetCount+=1,_.resolve()}updateTargetData(e,t){return this.Ln(t),_.resolve()}removeTargetData(e,t){return this.Cr.delete(t.target),this.Mr.Ar(t.targetId),this.targetCount-=1,_.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Cr.forEach((o,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Cr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),_.waitFor(s).next(()=>i)}getTargetCount(e){return _.resolve(this.targetCount)}getTargetData(e,t){const n=this.Cr.get(t)||null;return _.resolve(n)}addMatchingKeys(e,t,n){return this.Mr.Tr(t,n),_.resolve()}removeMatchingKeys(e,t,n){this.Mr.dr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),_.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Mr.Ar(t),_.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Mr.Vr(t);return _.resolve(n)}containsKey(e,t){return _.resolve(this.Mr.containsKey(t))}}class ys{constructor(e,t){this.Nr={},this.overlays={},this.Br=new Pe(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=e(this),this.kr=new am(this),this.indexManager=new $_,this.remoteDocumentCache=new sm(n=>this.referenceDelegate.qr(n)),this.serializer=new Rl(t),this.Qr=new nm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new rm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Nr[e.toKey()];return n||(n=new im(t,this.referenceDelegate),this.Nr[e.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(e,t,n){I("MemoryPersistence","Starting transaction:",e);const i=new um(this.Br.next());return this.referenceDelegate.Kr(),n(i).next(s=>this.referenceDelegate.$r(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ur(e,t){return _.or(Object.values(this.Nr).map(n=>()=>n.containsKey(e,t)))}}class um extends kf{constructor(e){super(),this.currentSequenceNumber=e}}class zr{constructor(e){this.persistence=e,this.Wr=new gs,this.Gr=null}static zr(e){return new zr(e)}get jr(){if(this.Gr)return this.Gr;throw P()}addReference(e,t,n){return this.Wr.addReference(n,t),this.jr.delete(n.toString()),_.resolve()}removeReference(e,t,n){return this.Wr.removeReference(n,t),this.jr.add(n.toString()),_.resolve()}markPotentiallyOrphaned(e,t){return this.jr.add(t.toString()),_.resolve()}removeTarget(e,t){this.Wr.Ar(t.targetId).forEach(i=>this.jr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.jr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Kr(){this.Gr=new Set}$r(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.jr,n=>{const i=R.fromPath(n);return this.Hr(e,i).next(s=>{s||t.removeEntry(i,S.min())})}).next(()=>(this.Gr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hr(e,t).next(n=>{n?this.jr.delete(t.toString()):this.jr.add(t.toString())})}qr(e){return 0}Hr(e,t){return _.or([()=>_.resolve(this.Wr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ur(e,t)])}}class Es{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Li=n,this.ki=i}static qi(e,t){let n=D(),i=D();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Es(e,t.fromCache,n,i)}}class Jl{constructor(){this.Qi=!1}initialize(e,t){this.Ki=e,this.indexManager=t,this.Qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.$i(e,t).next(s=>s||this.Ui(e,t,i,n)).next(s=>s||this.Wi(e,t))}$i(e,t){if(Lc(t))return _.resolve(null);let n=ve(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=kr(t,null,"F"),n=ve(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const o=D(...s);return this.Ki.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,n).next(u=>{const c=this.Gi(t,a);return this.zi(t,c,o,u.readTime)?this.$i(e,kr(t,null,"F")):this.ji(e,c,t,u)}))})))}Ui(e,t,n,i){return Lc(t)||i.isEqual(S.min())?this.Wi(e,t):this.Ki.getDocuments(e,n).next(s=>{const o=this.Gi(t,s);return this.zi(t,o,n,i)?this.Wi(e,t):(Oi()<=Ue.in.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Yi(t)),this.ji(e,o,t,function rc(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=S.fromTimestamp(1e9===n?new H(t+1,0):new H(t,n));return new we(i,R.empty(),e)}(i,-1)))})}Gi(e,t){let n=new W(function Gc(r){return(e,t)=>{let n=!1;for(const i of Et(r)){const s=l_(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}(e));return t.forEach((i,s)=>{Cn(e,s)&&(n=n.add(s))}),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Wi(e,t){return Oi()<=Ue.in.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Yi(t)),this.Ki.getDocumentsMatchingQuery(e,t,we.min())}ji(e,t,n,i){return this.Ki.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class lm{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new K(x),this.Yi=new Be(s=>vt(s),Sn),this.Zi=new Map,this.Xi=e.getRemoteDocumentCache(),this.kr=e.getTargetCache(),this.Qr=e.getBundleCache(),this.es(n)}es(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Zl(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function ed(r,e){return As.apply(this,arguments)}function As(){return(As=(0,p.Z)(function*(r,e){const t=w(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.es(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const o=[],a=[];let u=D();for(const c of i){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of s){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(n,u).next(c=>({ts:c,removedBatchIds:o,addedBatchIds:a}))})})})).apply(this,arguments)}function fm(r,e){const t=w(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}class ks{constructor(){this.activeTargetIds=function Ji(){return __}()}hs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ps(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ls(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ud{constructor(){this.Hs=new ks,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hs.hs(e),this.Js[e]||"not-current"}updateQueryState(e,t,n){this.Js[e]=t}removeLocalQueryTarget(e){this.Hs.Ps(e)}isLocalQueryTarget(e){return this.Hs.activeTargetIds.has(e)}clearQueryState(e){delete this.Js[e]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(e){return this.Hs.activeTargetIds.has(e)}start(){return this.Hs=new ks,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pm{Ys(e){}shutdown(){}}class cd{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(e){this.ro.push(e)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ro)e(0)}no(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ro)e(1)}static v(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Hr=null;function Vs(){return null===Hr?Hr=268435456+Math.round(2147483648*Math.random()):Hr++,"0x"+Hr.toString(16)}const gm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ym{constructor(e){this.so=e.so,this.oo=e.oo}_o(e){this.ao=e}uo(e){this.co=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.so(e)}ho(){this.ao()}Po(e){this.co(e)}Io(e){this.lo(e)}}const Te="WebChannelConnection";class Im extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.To=(t.ssl?"https":"http")+"://"+t.host,this.Eo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get Ao(){return!1}Ro(t,n,i,s,o){const a=Vs(),u=this.Vo(t,n);I("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);const c={};return this.mo(c,s,o),this.fo(t,u,c,i).then(l=>(I("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Ve("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}po(t,n,i,s,o,a){return this.Ro(t,n,i,s,o)}mo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Ft,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}Vo(t,n){return`${this.To}/v1/${n}:${gm[t]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}fo(e,t,n,i){const s=Vs();return new Promise((o,a)=>{const u=new ge.JJ;u.setWithCredentials(!0),u.listenOnce(ge.tw.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ge.jK.NO_ERROR:const l=u.getResponseJson();I(Te,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case ge.jK.TIMEOUT:I(Te,`RPC '${e}' ${s} timed out`),a(new g(m.DEADLINE_EXCEEDED,"Request time out"));break;case ge.jK.HTTP_ERROR:const d=u.getStatus();if(I(Te,`RPC '${e}' ${s} failed with status:`,d,"response text:",u.getResponseText()),d>0){let h=u.getResponseJson();Array.isArray(h)&&(h=h[0]);const f=null==h?void 0:h.error;if(f&&f.status&&f.message){const T=function(v){const k=v.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(k)>=0?k:m.UNKNOWN}(f.status);a(new g(T,f.message))}else a(new g(m.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new g(m.UNAVAILABLE,"Connection failed."));break;default:P()}}finally{I(Te,`RPC '${e}' ${s} completed.`)}});const c=JSON.stringify(i);I(Te,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,n,15)})}yo(e,t,n){const i=Vs(),s=[this.To,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=(0,ge.UE)(),a=(0,ge.FJ)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new ge.zI({})),this.mo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const l=s.join("");I(Te,`Creating RPC '${e}' stream ${i}: ${l}`,u);const d=o.createWebChannel(l,u);let h=!1,f=!1;const T=new ym({so:v=>{f?I(Te,`Not sending because RPC '${e}' stream ${i} is closed:`,v):(h||(I(Te,`Opening RPC '${e}' stream ${i} transport.`),d.open(),h=!0),I(Te,`RPC '${e}' stream ${i} sending:`,v),d.send(v))},oo:()=>d.close()}),E=(v,k,V)=>{v.listen(k,C=>{try{V(C)}catch(N){setTimeout(()=>{throw N},0)}})};return E(d,ge.ii.EventType.OPEN,()=>{f||I(Te,`RPC '${e}' stream ${i} transport opened.`)}),E(d,ge.ii.EventType.CLOSE,()=>{f||(f=!0,I(Te,`RPC '${e}' stream ${i} transport closed`),T.Po())}),E(d,ge.ii.EventType.ERROR,v=>{f||(f=!0,Ve(Te,`RPC '${e}' stream ${i} transport errored:`,v),T.Po(new g(m.UNAVAILABLE,"The operation could not be completed")))}),E(d,ge.ii.EventType.MESSAGE,v=>{var k;if(!f){const V=v.data[0];b(!!V);const N=V.error||(null===(k=V[0])||void 0===k?void 0:k.error);if(N){I(Te,`RPC '${e}' stream ${i} received error:`,N);const q=N.status;let U=function(mr){const Vi=ie[mr];if(void 0!==Vi)return function il(r){if(void 0===r)return X("GRPC error has no .code"),m.UNKNOWN;switch(r){case ie.OK:return m.OK;case ie.CANCELLED:return m.CANCELLED;case ie.UNKNOWN:return m.UNKNOWN;case ie.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ie.INTERNAL:return m.INTERNAL;case ie.UNAVAILABLE:return m.UNAVAILABLE;case ie.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ie.NOT_FOUND:return m.NOT_FOUND;case ie.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ie.ABORTED:return m.ABORTED;case ie.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ie.DATA_LOSS:return m.DATA_LOSS;default:return P()}}(Vi)}(q),ce=N.message;void 0===U&&(U=m.INTERNAL,ce="Unknown error status: "+q+" with message "+N.message),f=!0,T.Po(new g(U,ce)),d.close()}else I(Te,`RPC '${e}' stream ${i} received:`,V),T.Io(V)}}),E(a,ge.ju.STAT_EVENT,v=>{v.stat===ge.kN.PROXY?I(Te,`RPC '${e}' stream ${i} detected buffering proxy`):v.stat===ge.kN.NOPROXY&&I(Te,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{T.ho()},0),T}}function Zr(){return typeof document<"u"?document:null}function Hn(r){return new S_(r,!0)}class xs{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ii=e,this.timerId=t,this.wo=n,this.So=i,this.bo=s,this.Do=0,this.vo=null,this.Co=Date.now(),this.reset()}reset(){this.Do=0}Fo(){this.Do=this.bo}Mo(e){this.cancel();const t=Math.floor(this.Do+this.xo()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-n);i>0&&I("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Do} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.vo=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.Do*=this.So,this.Do<this.wo&&(this.Do=this.wo),this.Do>this.bo&&(this.Do=this.bo)}Oo(){null!==this.vo&&(this.vo.skipDelay(),this.vo=null)}cancel(){null!==this.vo&&(this.vo.cancel(),this.vo=null)}xo(){return(Math.random()-.5)*this.Do}}class Tm{constructor(e,t,n,i,s,o,a,u){this.ii=e,this.No=n,this.Bo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Lo=0,this.ko=null,this.qo=null,this.stream=null,this.Qo=new xs(e,t)}Ko(){return 1===this.state||5===this.state||this.$o()}$o(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Uo()}stop(){var e=this;return(0,p.Z)(function*(){e.Ko()&&(yield e.close(0))})()}Wo(){this.state=0,this.Qo.reset()}Go(){this.$o()&&null===this.ko&&(this.ko=this.ii.enqueueAfterDelay(this.No,6e4,()=>this.zo()))}jo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,p.Z)(function*(){if(e.$o())return e.close(0)})()}Ho(){this.ko&&(this.ko.cancel(),this.ko=null)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}close(e,t){var n=this;return(0,p.Z)(function*(){n.Ho(),n.Jo(),n.Qo.cancel(),n.Lo++,4!==e?n.Qo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(X(t.toString()),X("Using maximum backoff delay to prevent overloading the backend."),n.Qo.Fo()):t&&t.code===m.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.Yo(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.uo(t)})()}Yo(){}auth(){this.state=1;const e=this.Zo(this.Lo),t=this.Lo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Lo===t&&this.Xo(n,i)},n=>{e(()=>{const i=new g(m.UNKNOWN,"Fetching auth token failed: "+n.message);return this.e_(i)})})}Xo(e,t){const n=this.Zo(this.Lo);this.stream=this.t_(e,t),this.stream._o(()=>{n(()=>(this.state=2,this.qo=this.ii.enqueueAfterDelay(this.Bo,1e4,()=>(this.$o()&&(this.state=3),Promise.resolve())),this.listener._o()))}),this.stream.uo(i=>{n(()=>this.e_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}Uo(){var e=this;this.state=5,this.Qo.Mo((0,p.Z)(function*(){e.state=0,e.start()}))}e_(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Zo(e){return t=>{this.ii.enqueueAndForget(()=>this.Lo===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Em extends Tm{constructor(e,t,n,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,o),this.serializer=s,this.s_=!1}get o_(){return this.s_}start(){this.s_=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.s_&&this.__([])}t_(e,t){return this.connection.yo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.s_){this.Qo.reset();const t=function x_(r,e){return r&&r.length>0?(b(void 0!==e),r.map(t=>function(i,s){let o=te(i.updateTime?i.updateTime:s);return o.isEqual(S.min())&&(o=te(s)),new y_(o,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=te(e.commitTime);return this.listener.a_(n,t)}return b(!e.writeResults||0===e.writeResults.length),this.s_=!0,this.listener.u_()}c_(){const e={};e.database=function Un(r){return new L(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}(this.serializer),this.jo(e)}__(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>function Gn(r,e){let t;if(e instanceof jt)t={update:gl(r,e.key,e.value)};else if(e instanceof Qt)t={delete:Fn(r,e.key)};else if(e instanceof ze)t={update:gl(r,e.key,e.data),updateMask:L_(e.fieldMask)};else{if(!(e instanceof Xi))return P();t={verify:Fn(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,o){const a=o.transform;if(a instanceof Wt)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof At)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Rt)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof $t)return{fieldPath:o.field.canonicalString(),increment:a.Te};throw P()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:k_(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:P()),t;var s}(this.serializer,n))};this.jo(t)}}class Am extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.l_=!1}h_(){if(this.l_)throw new g(m.FAILED_PRECONDITION,"The client has already been terminated.")}Ro(e,t,n){return this.h_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Ro(e,t,n,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new g(m.UNKNOWN,i.toString())})}po(e,t,n,i){return this.h_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.po(e,t,n,s,o,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new g(m.UNKNOWN,s.toString())})}terminate(){this.l_=!0}}class wm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.I_=0,this.T_=null,this.E_=!0}d_(){0===this.I_&&(this.A_("Unknown"),this.T_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.T_=null,this.R_("Backend didn't respond within 10 seconds."),this.A_("Offline"),Promise.resolve())))}V_(e){"Online"===this.state?this.A_("Unknown"):(this.I_++,this.I_>=1&&(this.m_(),this.R_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.A_("Offline")))}set(e){this.m_(),this.I_=0,"Online"===e&&(this.E_=!1),this.A_(e)}A_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}R_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.E_?(X(t),this.E_=!1):I("OnlineStateTracker",t)}m_(){null!==this.T_&&(this.T_.cancel(),this.T_=null)}}class Pm{constructor(e,t,n,i,s){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.f_=[],this.g_=new Map,this.p_=new Set,this.y_=[],this.w_=s,this.w_.Ys(a=>{n.enqueueAndForget((0,p.Z)(function*(){var u;lt(o)&&(I("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(l){const d=w(l);d.p_.add(4),yield tn(d),d.S_.set("Unknown"),d.p_.delete(4),yield Zn(d)}),function c(l){return u.apply(this,arguments)})(o))}))}),this.S_=new wm(n,i)}}function Zn(r){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,p.Z)(function*(r){if(lt(r))for(const e of r.y_)yield e(!0)})).apply(this,arguments)}function tn(r){return Os.apply(this,arguments)}function Os(){return(Os=(0,p.Z)(function*(r){for(const e of r.y_)yield e(!1)})).apply(this,arguments)}function lt(r){return 0===w(r).p_.size}function Jr(r,e,t){return Bs.apply(this,arguments)}function Bs(){return(Bs=(0,p.Z)(function*(r,e,t){if(!Xe(e))throw e;r.p_.add(1),yield tn(r),r.S_.set("Offline"),t||(t=()=>function td(r){const e=w(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.kr.getLastRemoteSnapshotVersion(t))}(r.localStore)),r.asyncQueue.enqueueRetryable((0,p.Z)(function*(){I("RemoteStore","Retrying IndexedDB access"),yield t(),r.p_.delete(1),yield Zn(r)}))})).apply(this,arguments)}function fd(r,e){return e().catch(t=>Jr(r,t,e))}function nn(r){return zs.apply(this,arguments)}function zs(){return(zs=(0,p.Z)(function*(r){const e=w(r),t=dt(e);let n=e.f_.length>0?e.f_[e.f_.length-1].batchId:-1;for(;Cm(e);)try{const i=yield fm(e.localStore,n);if(null===i){0===e.f_.length&&t.Go();break}n=i.batchId,Vm(e,i)}catch(i){yield Jr(e,i)}_d(e)&&md(e)})).apply(this,arguments)}function Cm(r){return lt(r)&&r.f_.length<10}function Vm(r,e){r.f_.push(e);const t=dt(r);t.$o()&&t.o_&&t.__(e.mutations)}function _d(r){return lt(r)&&!dt(r).Ko()&&r.f_.length>0}function md(r){dt(r).start()}function xm(r){return Ks.apply(this,arguments)}function Ks(){return(Ks=(0,p.Z)(function*(r){dt(r).c_()})).apply(this,arguments)}function Dm(r){return Ws.apply(this,arguments)}function Ws(){return(Ws=(0,p.Z)(function*(r){const e=dt(r);for(const t of r.f_)e.__(t.mutations)})).apply(this,arguments)}function Nm(r,e,t){return $s.apply(this,arguments)}function $s(){return($s=(0,p.Z)(function*(r,e,t){const n=r.f_.shift(),i=ts.from(n,e,t);yield fd(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield nn(r)})).apply(this,arguments)}function Om(r,e){return js.apply(this,arguments)}function js(){return js=(0,p.Z)(function*(r,e){var t;e&&dt(r).o_&&(yield(t=(0,p.Z)(function*(i,s){if(function rl(r){switch(r){default:return P();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}(a=s.code)&&a!==m.ABORTED){const o=i.f_.shift();dt(i).Wo(),yield fd(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield nn(i)}var a}),function n(i,s){return t.apply(this,arguments)})(r,e)),_d(r)&&md(r)}),js.apply(this,arguments)}function pd(r,e){return Qs.apply(this,arguments)}function Qs(){return(Qs=(0,p.Z)(function*(r,e){const t=w(r);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const n=lt(t);t.p_.add(3),yield tn(t),n&&t.S_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.p_.delete(3),yield Zn(t)})).apply(this,arguments)}function Hs(r,e){return Zs.apply(this,arguments)}function Zs(){return(Zs=(0,p.Z)(function*(r,e){const t=w(r);e?(t.p_.delete(2),yield Zn(t)):e||(t.p_.add(2),yield tn(t),t.S_.set("Unknown"))})).apply(this,arguments)}function dt(r){return r.v_||(r.v_=function(t,n,i){const s=w(t);return s.h_(),new Em(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{_o:xm.bind(null,r),uo:Om.bind(null,r),u_:Dm.bind(null,r),a_:Nm.bind(null,r)}),r.y_.push(function(){var e=(0,p.Z)(function*(t){t?(r.v_.Wo(),yield nn(r)):(yield r.v_.stop(),r.f_.length>0&&(I("RemoteStore",`Stopping write stream with ${r.f_.length} pending writes`),r.f_=[]))});return function(t){return e.apply(this,arguments)}}())),r.v_}class Ys{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,n,i,s){const o=Date.now()+n,a=new Ys(e,t,o,i,s);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new g(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function sn(r,e){if(X("AsyncQueue",`${e}: ${r}`),Xe(r))return new g(m.UNAVAILABLE,`${e}: ${r}`);throw r}class Lm{constructor(){this.queries=new Be(e=>Fc(e),kn),this.onlineState="Unknown",this.x_=new Set}}class Km{constructor(e,t,n,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Ia={},this.Ta=new Be(a=>Fc(a),kn),this.Ea=new Map,this.da=new Set,this.Aa=new K(R.comparator),this.Ra=new Map,this.Va=new gs,this.ma={},this.fa=new Map,this.ga=Ct.On(),this.onlineState="Unknown",this.pa=void 0}get isPrimaryClient(){return!0===this.pa}}function uo(){return(uo=(0,p.Z)(function*(r,e,t){const n=function ko(r){const e=w(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Hm.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zm.bind(null,e),e}(r);try{const i=yield function(o,a){const u=w(o),c=H.now(),l=a.reduce((f,T)=>f.add(T.key),D());let d,h;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let T=Ae(),E=D();return u.Xi.getEntries(f,l).next(v=>{T=v,T.forEach((k,V)=>{V.isValidDocument()||(E=E.add(k))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,T)).next(v=>{d=v;const k=[];for(const V of a){const C=T_(V,d.get(V.key).overlayedDocument);null!=C&&k.push(new ze(V.key,C,Rc(C.value.mapValue),Q.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,k,a)}).next(v=>{h=v;const k=v.applyToLocalDocumentSet(d,E);return u.documentOverlayCache.saveOverlays(f,v.batchId,k)})}).then(()=>({batchId:h.batchId,changes:Bc(d)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.ma[o.currentUser.toKey()];c||(c=new K(x)),c=c.insert(a,u),o.ma[o.currentUser.toKey()]=c}(n,i.batchId,t),yield We(n,i.changes),yield nn(n.remoteStore)}catch(i){const s=sn(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Rd(r,e,t){const n=w(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Ta.forEach((s,o)=>{const a=o.view.O_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const u=w(o);u.onlineState=a;let c=!1;u.queries.forEach((l,d)=>{for(const h of d.listeners)h.O_(a)&&(c=!0)}),c&&function no(r){r.x_.forEach(e=>{e.next()})}(u)}(n.eventManager,e),i.length&&n.Ia.n_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Hm(r,e){return ho.apply(this,arguments)}function ho(){return(ho=(0,p.Z)(function*(r,e){const t=w(r),n=e.batch.batchId;try{const i=yield function dm(r,e){const t=w(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.Xi.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){const d=c.batch,h=d.keys();let f=_.resolve();return h.forEach(T=>{f=f.next(()=>l.getEntry(u,T)).next(E=>{const v=c.docVersions.get(T);b(null!==v),E.version.compareTo(v)<0&&(d.applyToRemoteDocument(E,c),E.isValidDocument()&&(E.setReadTime(c.commitVersion),l.addEntry(E)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,d))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(a){let u=D();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);po(t,n,null),mo(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield We(t,i)}catch(i){yield Je(i)}})).apply(this,arguments)}function Zm(r,e,t){return fo.apply(this,arguments)}function fo(){return(fo=(0,p.Z)(function*(r,e,t){const n=w(r);try{const i=yield function(o,a){const u=w(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(d=>(b(null!==d),l=d.keys(),u.mutationQueue.removeMutationBatch(c,d))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(n.localStore,e);po(n,e,t),mo(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield We(n,i)}catch(i){yield Je(i)}})).apply(this,arguments)}function mo(r,e){(r.fa.get(e)||[]).forEach(t=>{t.resolve()}),r.fa.delete(e)}function po(r,e,t){const n=w(r);let i=n.ma[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.ma[n.currentUser.toKey()]=i}}function We(r,e,t){return Io.apply(this,arguments)}function Io(){return Io=(0,p.Z)(function*(r,e,t){const n=w(r),i=[],s=[],o=[];var a;n.Ta.isEmpty()||(n.Ta.forEach((a,u)=>{o.push(n.ya(u,e,t).then(c=>{if((c||t)&&n.isPrimaryClient&&n.sharedClientState.updateQueryState(u.targetId,null!=c&&c.fromCache?"not-current":"current"),c){i.push(c);const l=Es.qi(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),n.Ia.n_(i),yield(a=(0,p.Z)(function*(c,l){const d=w(c);try{yield d.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>_.forEach(l,f=>_.forEach(f.Li,T=>d.persistence.referenceDelegate.addReference(h,f.targetId,T)).next(()=>_.forEach(f.ki,T=>d.persistence.referenceDelegate.removeReference(h,f.targetId,T)))))}catch(h){if(!Xe(h))throw h;I("LocalStore","Failed to update sequence numbers: "+h)}for(const h of l){const f=h.targetId;if(!h.fromCache){const T=d.Ji.get(f),v=T.withLastLimboFreeSnapshotVersion(T.snapshotVersion);d.Ji=d.Ji.insert(f,v)}}}),function u(c,l){return a.apply(this,arguments)})(n.localStore,s))}),Io.apply(this,arguments)}function Xm(r,e){return To.apply(this,arguments)}function To(){return(To=(0,p.Z)(function*(r,e){const t=w(r);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const n=yield ed(t.localStore,e);t.currentUser=e,(s=t).fa.forEach(a=>{a.forEach(u=>{u.reject(new g(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.fa.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield We(t,n.ts)}var s})).apply(this,arguments)}class Xr{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.serializer=Hn(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function Xl(r,e,t,n){return new lm(r,e,t,n)}(this.persistence,new Jl,e.initialUser,this.serializer)}createPersistence(e){return new ys(zr.zr,this.serializer)}createSharedClientState(e){return new ud}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class cn{initialize(e,t){var n=this;return(0,p.Z)(function*(){n.localStore||(n.localStore=e.localStore,n.sharedClientState=e.sharedClientState,n.datastore=n.createDatastore(t),n.remoteStore=n.createRemoteStore(t),n.eventManager=n.createEventManager(t),n.syncEngine=n.createSyncEngine(t,!e.synchronizeTabs),n.sharedClientState.onlineStateHandler=i=>Rd(n.syncEngine,i,1),n.remoteStore.remoteSyncer.handleCredentialChange=Xm.bind(null,n.syncEngine),yield Hs(n.remoteStore,n.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Lm}createDatastore(e){const t=Hn(e.databaseInfo.databaseId),n=new Im(e.databaseInfo);return new Am(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return n=this.localStore,i=this.datastore,s=e.asyncQueue,o=t=>Rd(this.syncEngine,t,0),a=cd.v()?new cd:new pm,new Pm(n,i,s,o,a);var n,i,s,o,a}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){const d=new Km(i,s,o,a,u,c);return l&&(d.pa=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(n){const i=w(n);I("RemoteStore","RemoteStore shutting down."),i.p_.add(5),yield tn(i),i.w_.shutdown(),i.S_.set("Unknown")}),function t(n){return e.apply(this,arguments)})(this.remoteStore);var e}}class fp{constructor(e,t,n,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=le.UNAUTHENTICATED,this.clientId=tc.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,function(){var o=(0,p.Z)(function*(a){I("FirestoreClient","Received user=",a.uid),yield s.authCredentialListener(a),s.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(n,o=>(I("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new g(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ae;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=sn(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function ti(r,e){return Co.apply(this,arguments)}function Co(){return Co=(0,p.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=yield r.getConfiguration();yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,p.Z)(function*(s){n.isEqual(s)||(yield ed(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),Co.apply(this,arguments)}function Vo(r,e){return xo.apply(this,arguments)}function xo(){return(xo=(0,p.Z)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield function Do(r){return No.apply(this,arguments)}(r);I("FirestoreClient","Initializing OnlineComponentProvider");const n=yield r.getConfiguration();yield e.initialize(t,n),r.setCredentialChangeListener(i=>pd(e.remoteStore,i)),r.setAppCheckTokenChangeListener((i,s)=>pd(e.remoteStore,s)),r._onlineComponents=e})).apply(this,arguments)}function No(){return(No=(0,p.Z)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){I("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ti(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function Vd(r){return"FirebaseError"===r.name?r.code===m.FAILED_PRECONDITION||r.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||22===r.code||20===r.code||11===r.code}(t))throw t;Ve("Error using user provided cache. Falling back to memory cache: "+t),yield ti(r,new Xr)}}else I("FirestoreClient","Using default OfflineComponentProvider"),yield ti(r,new Xr);return r._offlineComponents})).apply(this,arguments)}function Oo(){return(Oo=(0,p.Z)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(I("FirestoreClient","Using user provided OnlineComponentProvider"),yield Vo(r,r._uninitializedComponentsProvider._online)):(I("FirestoreClient","Using default OnlineComponentProvider"),yield Vo(r,new cn))),r._onlineComponents})).apply(this,arguments)}function Mo(r){return function ni(r){return Oo.apply(this,arguments)}(r).then(e=>e.syncEngine)}function Ld(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Fd=new Map;function Ud(r){if(!R.isDocumentKey(r))throw new g(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ii(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":P()}function M(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new g(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ii(r);throw new g(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}class Bd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new g(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new g(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function Ep(r,e,t,n){if(!0===e&&!0===n)throw new g(m.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Ld(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Jn{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Bd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new g(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new g(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Bd(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new If;switch(n.type){case"firstParty":return new Af(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new g(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Fd.get(t);n&&(I("ComponentProvider","Removing Datastore"),Fd.delete(t),n.terminate())}(this),Promise.resolve()}}class pe{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new pe(this.firestore,e,this._query)}}class ne{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Le(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ne(this.firestore,e,this._key)}}class Le extends pe{constructor(e,t,n){super(e,t,function Kt(r){return new qe(r)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ne(this.firestore,null,new R(e))}withConverter(e){return new Le(this.firestore,e,this._path)}}function zd(r,e,...t){if(r=(0,G.m9)(r),1===arguments.length&&(e=tc.V()),function Fo(r,e,t){if(!t)throw new g(m.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}("doc","path",e),r instanceof Jn){const n=L.fromString(e,...t);return Ud(n),new ne(r,null,new R(n))}{if(!(r instanceof ne||r instanceof Le))throw new g(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(L.fromString(e,...t));return Ud(n),new ne(r.firestore,r instanceof Le?r.converter:null,new R(n))}}class Rp{constructor(){this.Ua=Promise.resolve(),this.Wa=[],this.Ga=!1,this.za=[],this.ja=null,this.Ha=!1,this.Ja=!1,this.Ya=[],this.Qo=new xs(this,"async_queue_retry"),this.Za=()=>{const t=Zr();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Qo.Oo()};const e=Zr();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Za)}get isShuttingDown(){return this.Ga}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Xa(),this.eu(e)}enterRestrictedMode(e){if(!this.Ga){this.Ga=!0,this.Ja=e||!1;const t=Zr();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Za)}}enqueue(e){if(this.Xa(),this.Ga)return new Promise(()=>{});const t=new ae;return this.eu(()=>this.Ga&&this.Ja?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Wa.push(e),this.tu()))}tu(){var e=this;return(0,p.Z)(function*(){if(0!==e.Wa.length){try{yield e.Wa[0](),e.Wa.shift(),e.Qo.reset()}catch(t){if(!Xe(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}e.Wa.length>0&&e.Qo.Mo(()=>e.tu())}})()}eu(e){const t=this.Ua.then(()=>(this.Ha=!0,e().catch(n=>{throw this.ja=n,this.Ha=!1,X("INTERNAL UNHANDLED ERROR: ",function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+"\n"+o.stack),a}(n)),n}).then(n=>(this.Ha=!1,n))));return this.Ua=t,t}enqueueAfterDelay(e,t,n){this.Xa(),this.Ya.indexOf(e)>-1&&(t=0);const i=Ys.createAndSchedule(this,e,t,n,s=>this.nu(s));return this.za.push(i),i}Xa(){this.ja&&P()}verifyOperationInProgress(){}ru(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Ua,yield t}while(t!==e.Ua)})()}iu(e){for(const t of this.za)if(t.timerId===e)return!0;return!1}su(e){return this.ru().then(()=>{this.za.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.za)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ru()})}ou(e){this.Ya.push(e)}nu(e){const t=this.za.indexOf(e);this.za.splice(t,1)}}class j extends Jn{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Rp,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Wd(this),this._firestoreClient.terminate()}}function Wd(r){var e,t,n;const i=r._freezeSettings(),s=(u=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Xf(r._databaseId,u,r._persistenceKey,(l=i).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,Ld(l.experimentalLongPollingOptions),l.useFetchStreams));var u,l;r._firestoreClient=new fp(r._authCredentials,r._appCheckCredentials,r._queue,s),null!==(t=i.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class xt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xt(ue.fromBase64String(e))}catch(t){throw new g(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new xt(ue.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class dn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new g(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ee(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Qd{constructor(e){this._methodName=e}}class Go{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new g(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new g(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return x(this._lat,e._lat)||x(this._long,e._long)}}const bp=/^__.*__$/;class Sp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ze(e,this.data,this.fieldMask,t,this.fieldTransforms):new jt(e,this.data,t,this.fieldTransforms)}}function Zd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw P()}}class si{constructor(e,t,n,i,s,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this._u(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get au(){return this.settings.au}uu(e){return new si(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}cu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.uu({path:n,lu:!1});return i.hu(e),i}Pu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.uu({path:n,lu:!1});return i._u(),i}Iu(e){return this.uu({path:void 0,lu:!0})}Tu(e){return ai(e,this.settings.methodName,this.settings.Eu||!1,this.path,this.settings.du)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}_u(){if(this.path)for(let e=0;e<this.path.length;e++)this.hu(this.path.get(e))}hu(e){if(0===e.length)throw this.Tu("Document fields must not be empty");if(Zd(this.au)&&bp.test(e))throw this.Tu('Document fields cannot begin and end with "__"')}}class kp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Hn(e)}Au(e,t,n,i=!1){return new si({au:e,methodName:t,du:n,path:ee.emptyPath(),lu:!1,Eu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hn(r){const e=r._freezeSettings(),t=Hn(r._databaseId);return new kp(r._databaseId,!!e.ignoreUndefinedProperties,t)}function qo(r,e,t,n,i,s={}){const o=r.Au(s.merge||s.mergeFields?2:0,e,t,i);zo("Data must be an object, but it was:",o,n);const a=th(n,o);let u,c;if(s.merge)u=new Ee(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const d of s.mergeFields){const h=tr(e,d,t);if(!o.contains(h))throw new g(m.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);rh(l,h)||l.push(h)}u=new Ee(l),c=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,c=o.fieldTransforms;return new Sp(new me(a),u,c)}function Dt(r,e){if(nh(r=(0,G.m9)(r)))return zo("Unsupported field value:",e,r),th(r,e);if(r instanceof Qd)return function(n,i){if(!Zd(i.au))throw i.Tu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Tu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.lu&&4!==e.au)throw e.Tu("Nested arrays are not supported");return function(n,i){const s=[];let o=0;for(const a of n){let u=Dt(a,i.Iu(o));null==u&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,G.m9)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return $c(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=H.fromDate(n);return{timestampValue:Ht(i.serializer,s)}}if(n instanceof H){const s=new H(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Ht(i.serializer,s)}}if(n instanceof Go)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof xt)return{bytesValue:fl(i.serializer,n._byteString)};if(n instanceof ne){const s=i.databaseId,o=n.firestore._databaseId;if(!o.isEqual(s))throw i.Tu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:os(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Tu(`Unsupported field value: ${ii(n)}`)}(r,e)}function th(r,e){const t={};return mc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):et(r,(n,i)=>{const s=Dt(i,e.cu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function nh(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof H||r instanceof Go||r instanceof xt||r instanceof ne||r instanceof Qd)}function zo(r,e,t){if(!nh(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=ii(t);throw e.Tu("an object"===n?r+" a custom object":r+" "+n)}var i}function tr(r,e,t){if((e=(0,G.m9)(e))instanceof dn)return e._internalPath;if("string"==typeof e)return function oi(r,e,t){if(e.search(Dp)>=0)throw ai(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new dn(...e.split("."))._internalPath}catch{throw ai(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}(r,e);throw ai("Field path arguments must be of type string or ",r,!1,void 0,t)}const Dp=new RegExp("[~\\*/\\[\\]]");function ai(r,e,t,n,i){const s=n&&!n.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${n}`),o&&(u+=` in document ${i}`),u+=")"),new g(m.INVALID_ARGUMENT,a+r+u)}function rh(r,e){return r.some(t=>t.isEqual(e))}function ir(r,e){return function(n,i){const s=new ae;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function jm(r,e,t){return uo.apply(this,arguments)}(yield Mo(n),i,s)})),s.promise}(function se(r){return r._firestoreClient||Wd(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}(r),e)}!function(e,t=!0){Ft=Ce.Jn,(0,Ce.Xd)(new Ni.wA("firestore",(n,{instanceIdentifier:i,options:s})=>{const o=n.getProvider("app").getImmediate(),a=new j(new vf(n.getProvider("auth-internal")),new Rf(n.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new g(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new It(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),(0,Ce.KN)(Ju,"4.0.0",e),(0,Ce.KN)(Ju,"4.0.0","esm2017")}();var hh=z(2726);const Yp=(0,hh.fo)("SignInWithApple",{web:()=>z.e(4477).then(z.bind(z,4477)).then(r=>new r.SignInWithAppleWeb)});var jo=z(7582);const Jp=function fh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},_h=new G.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),_i=new Ue.Yd("@firebase/auth");function mi(r,...e){_i.logLevel<=Ue.in.ERROR&&_i.error(`Auth (${Ce.Jn}): ${r}`,...e)}function Re(r,...e){throw Qo(r,...e)}function be(r,...e){return Qo(r,...e)}function mh(r,e,t){const n=Object.assign(Object.assign({},Jp()),{[e]:t});return new G.LL("auth","Firebase",n).create(e,{appName:r.name})}function Qo(r,...e){if("string"!=typeof r){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return _h.create(r,...e)}function A(r,e,...t){if(!r)throw Qo(e,...t)}function Fe(r){const e="INTERNAL ASSERTION FAILED: "+r;throw mi(e),new Error(e)}function $e(r,e){r||Fe(e)}function ph(){var r;return typeof self<"u"&&(null===(r=self.location)||void 0===r?void 0:r.protocol)||null}class or{constructor(e,t){this.shortDelay=e,this.longDelay=t,$e(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,G.uI)()||(0,G.b$)()}get(){return function eg(){return!(typeof navigator<"u"&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function Ho(){return"http:"===ph()||"https:"===ph()}()||(0,G.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}class gh{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:typeof self<"u"&&"fetch"in self?self.fetch:void Fe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:typeof self<"u"&&"Headers"in self?self.Headers:void Fe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:typeof self<"u"&&"Response"in self?self.Response:void Fe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ng={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},rg=new or(3e4,6e4);function Z(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}function J(r,e,t,n){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,p.Z)(function*(r,e,t,n,i={}){return yh(r,i,(0,p.Z)(function*(){let s={},o={};n&&("GET"===e?o=n:s={body:JSON.stringify(n)});const a=(0,G.xO)(Object.assign({key:r.config.apiKey},o)).slice(1),u=yield r._getAdditionalHeaders();return u["Content-Type"]="application/json",r.languageCode&&(u["X-Firebase-Locale"]=r.languageCode),gh.fetch()(Ih(r,r.config.apiHost,t,a),Object.assign({method:e,headers:u,referrerPolicy:"no-referrer"},s))}))})).apply(this,arguments)}function yh(r,e,t){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,p.Z)(function*(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},ng),e);try{const i=new ig(r),s=yield Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=yield s.json();if("needConfirmation"in o)throw ar(r,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[u,c]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===u)throw ar(r,"credential-already-in-use",o);if("EMAIL_EXISTS"===u)throw ar(r,"email-already-in-use",o);if("USER_DISABLED"===u)throw ar(r,"user-disabled",o);const l=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw mh(r,l,c);Re(r,l)}}catch(i){if(i instanceof G.ZR)throw i;Re(r,"network-request-failed",{message:String(i)})}})).apply(this,arguments)}function Xo(){return(Xo=(0,p.Z)(function*(r,e,t,n,i={}){const s=yield J(r,e,t,n,i);return"mfaPendingCredential"in s&&Re(r,"multi-factor-auth-required",{_serverResponse:s}),s})).apply(this,arguments)}function Ih(r,e,t,n){const i=`${e}${t}?${n}`;return r.config.emulator?function Zo(r,e){$e(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}(r.config,i):`${r.config.apiScheme}://${i}`}class ig{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(be(this.auth,"network-request-failed")),rg.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ar(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const i=be(r,e,n);return i.customData._tokenResponse=t,i}function ea(){return(ea=(0,p.Z)(function*(r,e){return J(r,"POST","/v1/accounts:delete",e)})).apply(this,arguments)}function na(){return(na=(0,p.Z)(function*(r,e){return J(r,"POST","/v1/accounts:lookup",e)})).apply(this,arguments)}function ur(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function ra(){return(ra=(0,p.Z)(function*(r,e=!1){const t=(0,G.m9)(r),n=yield t.getIdToken(e),i=pi(n);A(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:ur(ia(i.auth_time)),issuedAtTime:ur(ia(i.iat)),expirationTime:ur(ia(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})).apply(this,arguments)}function ia(r){return 1e3*Number(r)}function pi(r){const[e,t,n]=r.split(".");if(void 0===e||void 0===t||void 0===n)return mi("JWT malformed, contained fewer than 3 sections"),null;try{const i=(0,G.tV)(t);return i?JSON.parse(i):(mi("Failed to decode base64 JWT payload"),null)}catch(i){return mi("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function Qe(r,e){return sa.apply(this,arguments)}function sa(){return(sa=(0,p.Z)(function*(r,e,t=!1){if(t)return e;try{return yield e}catch(n){throw n instanceof G.ZR&&function lg({code:r}){return"auth/user-disabled"===r||"auth/user-token-expired"===r}(n)&&r.auth.currentUser===r&&(yield r.auth.signOut()),n}})).apply(this,arguments)}class dg{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),n}{this.errorBackoff=3e4;const i=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){var t=this;if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout((0,p.Z)(function*(){yield t.iteration()}),n)}iteration(){var e=this;return(0,p.Z)(function*(){try{yield e.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&e.schedule(!0))}e.schedule()})()}}class Th{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ur(this.lastLoginAt),this.creationTime=ur(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function cr(r){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(r){var e;const t=r.auth,n=yield r.getIdToken(),i=yield Qe(r,function ag(r,e){return na.apply(this,arguments)}(t,{idToken:n}));A(null==i?void 0:i.users.length,t,"internal-error");const s=i.users[0];r._notifyReloadListener(s);const o=null!==(e=s.providerUserInfo)&&void 0!==e&&e.length?function _g(r){return r.map(e=>{var{providerId:t}=e,n=(0,jo._T)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}(s.providerUserInfo):[],a=function fg(r,e){return[...r.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}(r.providerData,o),l=!!r.isAnonymous&&!(r.email&&s.passwordHash||null!=a&&a.length),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Th(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(r,d)}),oa.apply(this,arguments)}function aa(){return(aa=(0,p.Z)(function*(r){const e=(0,G.m9)(r);yield cr(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})).apply(this,arguments)}function ua(){return(ua=(0,p.Z)(function*(r,e){const t=yield yh(r,{},(0,p.Z)(function*(){const n=(0,G.xO)({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=r.config,o=Ih(r,i,"/v1/token",`key=${s}`),a=yield r._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",gh.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})).apply(this,arguments)}class lr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){A(e.idToken,"internal-error"),A(typeof e.idToken<"u","internal-error"),A(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):function cg(r){const e=pi(r);return A(e,"internal-error"),A(typeof e.exp<"u","internal-error"),A(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}getToken(e,t=!1){var n=this;return(0,p.Z)(function*(){return A(!n.accessToken||n.refreshToken,e,"user-token-expired"),t||!n.accessToken||n.isExpired?n.refreshToken?(yield n.refresh(e,n.refreshToken),n.accessToken):null:n.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(e,t){var n=this;return(0,p.Z)(function*(){const{accessToken:i,refreshToken:s,expiresIn:o}=yield function mg(r,e){return ua.apply(this,arguments)}(e,t);n.updateTokensAndExpiration(i,s,Number(o))})()}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,o=new lr;return n&&(A("string"==typeof n,"internal-error",{appName:e}),o.refreshToken=n),i&&(A("string"==typeof i,"internal-error",{appName:e}),o.accessToken=i),s&&(A("number"==typeof s,"internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lr,this.toJSON())}_performRefresh(){return Fe("not implemented")}}function ft(r,e){A("string"==typeof r||typeof r>"u","internal-error",{appName:e})}class Ot{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=(0,jo._T)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new dg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Th(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){var t=this;return(0,p.Z)(function*(){const n=yield Qe(t,t.stsTokenManager.getToken(t.auth,e));return A(n,t.auth,"internal-error"),t.accessToken!==n&&(t.accessToken=n,yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)),n})()}getIdTokenResult(e){return function ug(r){return ra.apply(this,arguments)}(this,e)}reload(){return function hg(r){return aa.apply(this,arguments)}(this)}_assign(e){this!==e&&(A(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ot(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){A(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){var n=this;return(0,p.Z)(function*(){let i=!1;e.idToken&&e.idToken!==n.stsTokenManager.accessToken&&(n.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield cr(n)),yield n.auth._persistUserIfCurrent(n),i&&n.auth._notifyListenersIfCurrent(n)})()}delete(){var e=this;return(0,p.Z)(function*(){const t=yield e.getIdToken();return yield Qe(e,function sg(r,e){return ea.apply(this,arguments)}(e.auth,{idToken:t})),e.stsTokenManager.clearRefreshToken(),e.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,o,a,u,c,l;const d=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(i=t.email)&&void 0!==i?i:void 0,f=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,T=null!==(o=t.photoURL)&&void 0!==o?o:void 0,E=null!==(a=t.tenantId)&&void 0!==a?a:void 0,v=null!==(u=t._redirectEventId)&&void 0!==u?u:void 0,k=null!==(c=t.createdAt)&&void 0!==c?c:void 0,V=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:C,emailVerified:N,isAnonymous:q,providerData:U,stsTokenManager:ce}=t;A(C&&ce,e,"internal-error");const pt=lr.fromJSON(this.name,ce);A("string"==typeof C,e,"internal-error"),ft(d,e.name),ft(h,e.name),A("boolean"==typeof N,e,"internal-error"),A("boolean"==typeof q,e,"internal-error"),ft(f,e.name),ft(T,e.name),ft(E,e.name),ft(v,e.name),ft(k,e.name),ft(V,e.name);const mr=new Ot({uid:C,auth:e,email:h,emailVerified:N,displayName:d,isAnonymous:q,photoURL:T,phoneNumber:f,tenantId:E,stsTokenManager:pt,createdAt:k,lastLoginAt:V});return U&&Array.isArray(U)&&(mr.providerData=U.map(Vi=>Object.assign({},Vi))),v&&(mr._redirectEventId=v),mr}static _fromIdTokenResponse(e,t,n=!1){return(0,p.Z)(function*(){const i=new lr;i.updateFromServerResponse(t);const s=new Ot({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield cr(s),s})()}}const vh=new Map;function He(r){$e(r instanceof Function,"Expected a class definition");let e=vh.get(r);return e?($e(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,vh.set(r,e),e)}const Eh=(()=>{class r{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,p.Z)(function*(){return!0})()}_set(t,n){var i=this;return(0,p.Z)(function*(){i.storage[t]=n})()}_get(t){var n=this;return(0,p.Z)(function*(){const i=n.storage[t];return void 0===i?null:i})()}_remove(t){var n=this;return(0,p.Z)(function*(){delete n.storage[t]})()}_addListener(t,n){}_removeListener(t,n){}}return r.type="NONE",r})();function gi(r,e,t){return`firebase:${r}:${e}:${t}`}class pn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=gi(this.userKey,i.apiKey,s),this.fullPersistenceKey=gi("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){var e=this;return(0,p.Z)(function*(){const t=yield e.persistence._get(e.fullUserKey);return t?Ot._fromJSON(e.auth,t):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){var t=this;return(0,p.Z)(function*(){if(t.persistence===e)return;const n=yield t.getCurrentUser();return yield t.removeCurrentUser(),t.persistence=e,n?t.setCurrentUser(n):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return(0,p.Z)(function*(){if(!t.length)return new pn(He(Eh),e,n);const i=(yield Promise.all(t.map(function(){var c=(0,p.Z)(function*(l){if(yield l._isAvailable())return l});return function(l){return c.apply(this,arguments)}}()))).filter(c=>c);let s=i[0]||He(Eh);const o=gi(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const l=yield c._get(o);if(l){const d=Ot._fromJSON(e,l);c!==s&&(a=d),s=c;break}}catch{}const u=i.filter(c=>c._shouldAllowMigration);return s._shouldAllowMigration&&u.length?(s=u[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(function(){var c=(0,p.Z)(function*(l){if(l!==s)try{yield l._remove(o)}catch{}});return function(l){return c.apply(this,arguments)}}())),new pn(s,e,n)):new pn(s,e,n)})()}}function Ah(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(function Ph(r=(0,G.z$)()){return/iemobile/i.test(r)}(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(function Rh(r=(0,G.z$)()){return/firefox\//i.test(r)}(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(function Sh(r=(0,G.z$)()){return/blackberry/i.test(r)}(e))return"Blackberry";if(function kh(r=(0,G.z$)()){return/webos/i.test(r)}(e))return"Webos";if(function ca(r=(0,G.z$)()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}(e))return"Safari";if((e.includes("chrome/")||function wh(r=(0,G.z$)()){return/crios\//i.test(r)}(e))&&!e.includes("edge/"))return"Chrome";if(function bh(r=(0,G.z$)()){return/android/i.test(r)}(e))return"Android";{const n=r.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ch(r,e=[]){let t;switch(r){case"Browser":t=Ah((0,G.z$)());break;case"Worker":t=`${Ah((0,G.z$)())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Ce.Jn}/${n}`}function Vh(r,e){return da.apply(this,arguments)}function da(){return(da=(0,p.Z)(function*(r,e){return J(r,"GET","/v2/recaptchaConfig",Z(r,e))})).apply(this,arguments)}function Dh(r){return void 0!==r&&void 0!==r.enterprise}class Nh{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState)}}class Mh{constructor(e){this.type="recaptcha-enterprise",this.auth=fe(e)}verify(e="verify",t=!1){var n=this;return(0,p.Z)(function*(){function s(){return s=(0,p.Z)(function*(a){if(!t){if(null==a.tenantId&&null!=a._agentRecaptchaConfig)return a._agentRecaptchaConfig.siteKey;if(null!=a.tenantId&&void 0!==a._tenantRecaptchaConfigs[a.tenantId])return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(function(){var u=(0,p.Z)(function*(c,l){Vh(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(d=>{if(void 0!==d.recaptchaKey){const h=new Nh(d);return null==a.tenantId?a._agentRecaptchaConfig=h:a._tenantRecaptchaConfigs[a.tenantId]=h,c(h.siteKey)}l(new Error("recaptcha Enterprise site key undefined"))}).catch(d=>{l(d)})});return function(c,l){return u.apply(this,arguments)}}())}),s.apply(this,arguments)}function o(a,u,c){const l=window.grecaptcha;Dh(l)?l.enterprise.ready(()=>{l.enterprise.execute(a,{action:e}).then(d=>{u(d)}).catch(()=>{u("NO_RECAPTCHA")})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,u)=>{(function i(a){return s.apply(this,arguments)})(n.auth).then(c=>{if(!t&&Dh(window.grecaptcha))o(c,a,u);else{if(typeof window>"u")return void u(new Error("RecaptchaVerifier is only supported in browser"));(function ha(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=i=>{const s=be("internal-error");s.customData=i,t(s)},n.type="text/javascript",n.charset="UTF-8",function Ig(){var r,e;return null!==(e=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==e?e:document}().appendChild(n)})})("https://www.google.com/recaptcha/enterprise.js?render="+c).then(()=>{o(c,a,u)}).catch(l=>{u(l)})}}).catch(c=>{u(c)})})})()}}class Ag{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=s=>new Promise((o,a)=>{try{o(e(s))}catch(u){a(u)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){var t=this;return(0,p.Z)(function*(){if(t.auth.currentUser===e)return;const n=[];try{for(const i of t.queue)yield i(e),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const s of n)try{s()}catch{}throw t.auth._errorFactory.create("login-blocked",{originalMessage:null==i?void 0:i.message})}})()}}class Rg{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Lh(this),this.idTokenSubscription=new Lh(this),this.beforeStateQueue=new Ag(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_h,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){var n=this;return t&&(this._popupRedirectResolver=He(t)),this._initializationPromise=this.queue((0,p.Z)(function*(){var i,s;if(!n._deleted&&(n.persistenceManager=yield pn.create(n,e),!n._deleted)){if(null!==(i=n._popupRedirectResolver)&&void 0!==i&&i._shouldInitProactively)try{yield n._popupRedirectResolver._initialize(n)}catch{}yield n.initializeCurrentUser(t),n.lastNotifiedUid=(null===(s=n.currentUser)||void 0===s?void 0:s.uid)||null,!n._deleted&&(n._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var e=this;return(0,p.Z)(function*(){if(e._deleted)return;const t=yield e.assertedPersistence.getCurrentUser();if(e.currentUser||t){if(e.currentUser&&t&&e.currentUser.uid===t.uid)return e._currentUser._assign(t),void(yield e.currentUser.getIdToken());yield e._updateCurrentUser(t,!0)}})()}initializeCurrentUser(e){var t=this;return(0,p.Z)(function*(){var n;const i=yield t.assertedPersistence.getCurrentUser();let s=i,o=!1;if(e&&t.config.authDomain){yield t.getOrInitRedirectPersistenceManager();const a=null===(n=t.redirectUser)||void 0===n?void 0:n._redirectEventId,u=null==s?void 0:s._redirectEventId,c=yield t.tryRedirectSignIn(e);(!a||a===u)&&null!=c&&c.user&&(s=c.user,o=!0)}if(!s)return t.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{yield t.beforeStateQueue.runMiddleware(s)}catch(a){s=i,t._popupRedirectResolver._overrideRedirectResult(t,()=>Promise.reject(a))}return s?t.reloadAndSetCurrentUserOrClear(s):t.directlySetCurrentUser(null)}return A(t._popupRedirectResolver,t,"argument-error"),yield t.getOrInitRedirectPersistenceManager(),t.redirectUser&&t.redirectUser._redirectEventId===s._redirectEventId?t.directlySetCurrentUser(s):t.reloadAndSetCurrentUserOrClear(s)})()}tryRedirectSignIn(e){var t=this;return(0,p.Z)(function*(){let n=null;try{n=yield t._popupRedirectResolver._completeRedirectFn(t,e,!0)}catch{yield t._setRedirectUser(null)}return n})()}reloadAndSetCurrentUserOrClear(e){var t=this;return(0,p.Z)(function*(){try{yield cr(e)}catch(n){if("auth/network-request-failed"!==(null==n?void 0:n.code))return t.directlySetCurrentUser(null)}return t.directlySetCurrentUser(e)})()}useDeviceLanguage(){this.languageCode=function tg(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}()}_delete(){var e=this;return(0,p.Z)(function*(){e._deleted=!0})()}updateCurrentUser(e){var t=this;return(0,p.Z)(function*(){const n=e?(0,G.m9)(e):null;return n&&A(n.auth.config.apiKey===t.config.apiKey,t,"invalid-user-token"),t._updateCurrentUser(n&&n._clone(t))})()}_updateCurrentUser(e,t=!1){var n=this;return(0,p.Z)(function*(){if(!n._deleted)return e&&A(n.tenantId===e.tenantId,n,"tenant-id-mismatch"),t||(yield n.beforeStateQueue.runMiddleware(e)),n.queue((0,p.Z)(function*(){yield n.directlySetCurrentUser(e),n.notifyAuthListeners()}))})()}signOut(){var e=this;return(0,p.Z)(function*(){return yield e.beforeStateQueue.runMiddleware(null),(e.redirectPersistenceManager||e._popupRedirectResolver)&&(yield e._setRedirectUser(null)),e._updateCurrentUser(null,!0)})()}setPersistence(e){var t=this;return this.queue((0,p.Z)(function*(){yield t.assertedPersistence.setPersistence(He(e))}))}initializeRecaptchaConfig(){var e=this;return(0,p.Z)(function*(){const t=yield Vh(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),n=new Nh(t);null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,n.emailPasswordEnabled&&new Mh(e).verify()})()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new G.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}_setRedirectUser(e,t){var n=this;return(0,p.Z)(function*(){const i=yield n.getOrInitRedirectPersistenceManager(t);return null===e?i.removeCurrentUser():i.setCurrentUser(e)})()}getOrInitRedirectPersistenceManager(e){var t=this;return(0,p.Z)(function*(){if(!t.redirectPersistenceManager){const n=e&&He(e)||t._popupRedirectResolver;A(n,t,"argument-error"),t.redirectPersistenceManager=yield pn.create(t,[He(n._redirectPersistence)],"redirectUser"),t.redirectUser=yield t.redirectPersistenceManager.getCurrentUser()}return t.redirectPersistenceManager})()}_redirectUserForId(e){var t=this;return(0,p.Z)(function*(){var n,i;return t._isInitialized&&(yield t.queue((0,p.Z)(function*(){}))),(null===(n=t._currentUser)||void 0===n?void 0:n._redirectEventId)===e?t._currentUser:(null===(i=t.redirectUser)||void 0===i?void 0:i._redirectEventId)===e?t.redirectUser:null})()}_persistUserIfCurrent(e){var t=this;return(0,p.Z)(function*(){if(e===t.currentUser)return t.queue((0,p.Z)(function*(){return t.directlySetCurrentUser(e)}))})()}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return A(o,this,"internal-error"),o.then(()=>s(this.currentUser)),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}directlySetCurrentUser(e){var t=this;return(0,p.Z)(function*(){t.currentUser&&t.currentUser!==e&&t._currentUser._stopProactiveRefresh(),e&&t.isProactiveRefreshEnabled&&e._startProactiveRefresh(),t.currentUser=e,e?yield t.assertedPersistence.setCurrentUser(e):yield t.assertedPersistence.removeCurrentUser()})()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return A(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ch(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var e=this;return(0,p.Z)(function*(){var t;const n={"X-Client-Version":e.clientVersion};e.app.options.appId&&(n["X-Firebase-gmpid"]=e.app.options.appId);const i=yield null===(t=e.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader();i&&(n["X-Firebase-Client"]=i);const s=yield e._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n})()}_getAppCheckToken(){var e=this;return(0,p.Z)(function*(){var t;const n=yield null===(t=e.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken();return null!=n&&n.error&&function Xp(r,...e){_i.logLevel<=Ue.in.WARN&&_i.warn(`Auth (${Ce.Jn}): ${r}`,...e)}(`Error while retrieving App Check token: ${n.error}`),null==n?void 0:n.token})()}}function fe(r){return(0,G.m9)(r)}class Lh{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,G.ne)(t=>this.observer=t)}get next(){return A(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class Gh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fe("not implemented")}_getIdTokenResponse(e){return Fe("not implemented")}_linkToIdToken(e,t){return Fe("not implemented")}_getReauthenticationResolver(e){return Fe("not implemented")}}function Ze(r,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,p.Z)(function*(r,e){return function je(r,e,t,n){return Xo.apply(this,arguments)}(r,"POST","/v1/accounts:signInWithIdp",Z(r,e))})).apply(this,arguments)}class dr extends Gh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new dr(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Re("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=(0,jo._T)(t,["providerId","signInMethod"]);if(!n||!i)return null;const o=new dr(n,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){return Ze(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ze(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ze(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,G.xO)(t)}return e}}class mt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Kh extends mt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class gn extends Kh{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return A("providerId"in t&&"signInMethod"in t,"argument-error"),dr._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return A(e.idToken||e.accessToken,"argument-error"),dr._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return gn.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return gn.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:a}=e;if(!n&&!i&&!t&&!s||!a)return null;try{return new gn(a)._credential({idToken:t,accessToken:n,nonce:o,pendingToken:s})}catch{return null}}}class ke{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return(0,p.Z)(function*(){const s=yield Ot._fromIdTokenResponse(e,n,i),o=Wh(n);return new ke({user:s,providerId:o,_tokenResponse:n,operationType:t})})()}static _forOperation(e,t,n){return(0,p.Z)(function*(){yield e._updateTokensIfNecessary(n,!0);const i=Wh(n);return new ke({user:e,providerId:i,_tokenResponse:n,operationType:t})})()}}function Wh(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}class Ei extends G.ZR{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Ei.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Ei(e,t,n,i)}}function $h(r,e,t,n){return("reauthenticate"===e?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(s=>{throw"auth/multi-factor-auth-required"===s.code?Ei._fromErrorAndOperation(r,s,e,n):s})}function Ua(){return(Ua=(0,p.Z)(function*(r,e,t=!1){const n=yield Qe(r,e._linkToIdToken(r.auth,yield r.getIdToken()),t);return ke._forOperation(r,"link",n)})).apply(this,arguments)}function qa(){return(qa=(0,p.Z)(function*(r,e,t=!1){const{auth:n}=r,i="reauthenticate";try{const s=yield Qe(r,$h(n,i,e,r),t);A(s.idToken,n,"internal-error");const o=pi(s.idToken);A(o,n,"internal-error");const{sub:a}=o;return A(r.uid===a,n,"user-mismatch"),ke._forOperation(r,i,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&Re(n,"user-mismatch"),s}})).apply(this,arguments)}function Hh(r,e){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,p.Z)(function*(r,e,t=!1){const n="signIn",i=yield $h(r,n,e),s=yield ke._fromIdTokenResponse(r,n,i);return t||(yield r._updateCurrentUser(s.user)),s})).apply(this,arguments)}function Ri(r,e){return za.apply(this,arguments)}function za(){return(za=(0,p.Z)(function*(r,e){return Hh(fe(r),e)})).apply(this,arguments)}(function Oh(r){return`__${r}${Math.floor(1e6*Math.random())}`})("rcb"),new or(3e4,6e4);class ku extends Gh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ze(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ze(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ze(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ky(r){return Hh(r.auth,new ku(r),r.bypassAuthState)}function Cy(r){const{auth:e,user:t}=r;return A(t,e,"internal-error"),function Qh(r,e){return qa.apply(this,arguments)}(t,new ku(r),r.bypassAuthState)}function Vy(r){return Cu.apply(this,arguments)}function Cu(){return(Cu=(0,p.Z)(function*(r){const{auth:e,user:t}=r;return A(t,e,"internal-error"),function Fa(r,e){return Ua.apply(this,arguments)}(t,new ku(r),r.bypassAuthState)})).apply(this,arguments)}class xy{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){var e=this;return new Promise(function(){var t=(0,p.Z)(function*(n,i){e.pendingPromise={resolve:n,reject:i};try{e.eventManager=yield e.resolver._initialize(e.auth),yield e.onExecution(),e.eventManager.registerConsumer(e)}catch(s){e.reject(s)}});return function(n,i){return t.apply(this,arguments)}}())}onAuthEvent(e){var t=this;return(0,p.Z)(function*(){const{urlResponse:n,sessionId:i,postBody:s,tenantId:o,error:a,type:u}=e;if(a)return void t.reject(a);const c={auth:t.auth,requestUri:n,sessionId:i,tenantId:o||void 0,postBody:s||void 0,user:t.user,bypassAuthState:t.bypassAuthState};try{t.resolve(yield t.getIdpTask(u)(c))}catch(l){t.reject(l)}})()}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ky;case"linkViaPopup":case"linkViaRedirect":return Vy;case"reauthViaPopup":case"reauthViaRedirect":return Cy;default:Re(this.auth,"internal-error")}}resolve(e){$e(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$e(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Dy=new or(2e3,1e4);function Vu(){return(Vu=(0,p.Z)(function*(r,e,t){const n=fe(r);!function mn(r,e,t){if(!(e instanceof t))throw t.name!==e.constructor.name&&Re(r,"argument-error"),mh(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(r,e,mt);const i=function Lt(r,e){return e?He(e):(A(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}(n,t);return new Nu(n,"signInViaPopup",e,i).executeNotNull()})).apply(this,arguments)}let Nu=(()=>{class r extends xy{constructor(t,n,i,s,o){super(t,n,s,o),this.provider=i,this.authWindow=null,this.pollId=null,r.currentPopupAction&&r.currentPopupAction.cancel(),r.currentPopupAction=this}executeNotNull(){var t=this;return(0,p.Z)(function*(){const n=yield t.execute();return A(n,t.auth,"internal-error"),n})()}onExecution(){var t=this;return(0,p.Z)(function*(){$e(1===t.filter.length,"Popup operations only handle one event");const n=function wi(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(10*Math.random());return r+t}();t.authWindow=yield t.resolver._openPopup(t.auth,t.provider,t.filter[0],n),t.authWindow.associatedEvent=n,t.resolver._originValidation(t.auth).catch(i=>{t.reject(i)}),t.resolver._isIframeWebStorageSupported(t.auth,i=>{i||t.reject(be(t.auth,"web-storage-unsupported"))}),t.pollUserCancellation()})()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(be(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r.currentPopupAction=null}pollUserCancellation(){const t=()=>{var n,i;this.pollId=null!==(i=null===(n=this.authWindow)||void 0===n?void 0:n.window)&&void 0!==i&&i.closed?window.setTimeout(()=>{this.pollId=null,this.reject(be(this.auth,"popup-closed-by-user"))},8e3):window.setTimeout(t,Dy.get())};t()}}return r.currentPopupAction=null,r})();new or(3e4,6e4),new or(5e3,15e3),encodeURIComponent("fac");var mf="@firebase/auth";class yI{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}getToken(e){var t=this;return(0,p.Z)(function*(){return t.assertAuthConfigured(),yield t.auth._initializationPromise,t.auth.currentUser?{accessToken:yield t.auth.currentUser.getIdToken(e)}:null})()}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((null==n?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){A(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}(0,G.Pz)("authIdTokenMaxAge"),function TI(r){(0,Ce.Xd)(new Ni.wA("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=n.options;A(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:o,authDomain:a,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ch(r)},c=new Rg(n,i,s,u);return function Pg(r,e){const t=(null==e?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(He);null!=e&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,null==e?void 0:e.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,Ce.Xd)(new Ni.wA("auth-internal",e=>{const t=fe(e.getProvider("auth").getImmediate());return new yI(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,Ce.KN)(mf,"1.0.0",function II(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(r)),(0,Ce.KN)(mf,"1.0.0","esm2017")}("Browser");var RI=z(5619),y=z(6689),wI=z(7613),PI=z(2014),bI=z(2333),SI=z(9862),kI=z(6882),CI=z(2245);function VI(r,e){1&r&&(y.TgZ(0,"ion-note",25),y._uU(1,"Email is invalid"),y.qZA())}function xI(r,e){1&r&&(y.TgZ(0,"ion-note",25),y._uU(1,"Password is invalid"),y.qZA())}function DI(r,e){if(1&r){const t=y.EpF();y.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",13)(3,"ion-button",14),y.NdJ("click",function(){y.CHM(t);const i=y.oxw();return y.KtG(i.setClose(!1))}),y._uU(4,"Back"),y.qZA()()()(),y.TgZ(5,"ion-content",15)(6,"ion-card",16)(7,"ion-card-content")(8,"form",17),y.NdJ("ngSubmit",function(){y.CHM(t);const i=y.oxw();return y.KtG(i.login())}),y.TgZ(9,"ion-item",18),y._UZ(10,"ion-input",19),y.YNc(11,VI,2,0,"ion-note",20),y.qZA(),y.TgZ(12,"ion-item",18),y._UZ(13,"ion-input",21),y.YNc(14,xI,2,0,"ion-note",20),y.qZA(),y.TgZ(15,"ion-button",22),y.NdJ("click",function(){y.CHM(t);const i=y.oxw();return y.KtG(i.setOpen(!1))}),y._uU(16,"Login"),y.qZA(),y.TgZ(17,"ion-button",23),y.NdJ("click",function(){y.CHM(t);const i=y.oxw();return y.KtG(i.forgetPassword())}),y._uU(18,"Forget Password?"),y.qZA(),y._UZ(19,"br")(20,"br"),y.TgZ(21,"p"),y._uU(22,"If new user please register!"),y.qZA(),y.TgZ(23,"ion-button",24),y.NdJ("click",function(){y.CHM(t);const i=y.oxw();return y.KtG(i.setClose2(!1))}),y._uU(24,"Register"),y.qZA()()()()()}if(2&r){const t=y.oxw();y.xp6(8),y.Q6J("formGroup",t.credentials),y.xp6(3),y.Q6J("ngIf",(t.email.dirty||t.email.touched)&&t.email.errors),y.xp6(3),y.Q6J("ngIf",(t.password.dirty||t.password.touched)&&t.password.errors),y.xp6(1),y.Q6J("disabled",!t.credentials.valid)}}const NI=[{path:"",component:(()=>{class r{constructor(t,n,i,s,o,a,u,c,l,d){this.apiService=t,this.router=n,this.storage=i,this.fb=s,this.loadingController=o,this.alertController=a,this.authService=u,this.http=c,this.auth=l,this.firestore=d,this.isModalOpen=!1,this.isModalClose=!0,this.user=null,this._uid=new RI.X(null),this.auth.onAuthStateChanged(h=>{this.user=h}),(0,yf.n$)("capacitor")||Di.e.initialize()}ngOnInit(){var t=this;return(0,p.Z)(function*(){yield t.storage.create(),t.username=yield t.storage.get("username"),t.log=yield t.storage.get("log"),t.user_email=yield t.storage.get("email"),t.user_id=yield t.storage.get("userid"),t.appleid=yield t.storage.get("appleid"),t.apple_email=yield t.storage.get("apple_email"),t.credentials=t.fb.group({email:["",[Se.kI.required,Se.kI.email]],password:["",[Se.kI.required,Se.kI.minLength(6)]]}),(t.username||t.user_email||null!=t.appleid)&&t.router.navigateByUrl("menu/home")})()}get email(){var t;return null===(t=this.credentials)||void 0===t?void 0:t.get("email")}get password(){var t;return null===(t=this.credentials)||void 0===t?void 0:t.get("password")}signIn(){var t=this;return(0,p.Z)(function*(){t.username=yield Di.e.signIn();const n=yield t.loadingController.create();yield n.present(),t.username&&(t.storage.set("userState",!1),t.http.post("https://casa.evokemusic.net/api/login_api",{user_id:t.username.id,email:t.username.email}).subscribe(i=>{console.log("Username | Email :",t.username.id,t.username.email),console.log("Response :",i)}),t.router.navigateByUrl("menu/home"),yield t.storage.set("gmailid",t.username.id),yield t.storage.set("username",t.username),yield t.storage.set("google_email",t.username.email),console.log("Google ID :",t.username.email),yield n.dismiss())})()}refreshToken(){return(0,p.Z)(function*(){yield Di.e.refresh()})()}showAlert(t,n){var i=this;return(0,p.Z)(function*(){yield(yield i.alertController.create({header:t,message:n,buttons:["Okay"]})).present()})()}register(t){var n=this;return(0,p.Z)(function*(){n.isModalOpen=t,n.router.navigateByUrl("reg")})()}login(){var t=this;return(0,p.Z)(function*(){var n;const i=yield t.loadingController.create();yield i.present();const s=yield t.authService.login(null===(n=t.credentials)||void 0===n?void 0:n.value);var o,a,u,c;1==s?(yield i.dismiss(),console.log(null===(o=t.auth.currentUser)||void 0===o?void 0:o.uid,null===(a=t.credentials)||void 0===a?void 0:a.value.email),t.http.post("https://casa.evokemusic.net/api/login_api",{user_id:null===(u=t.auth.currentUser)||void 0===u?void 0:u.uid,email:null===(c=t.credentials)||void 0===c?void 0:c.value.email}).subscribe(l=>{}),t.router.navigateByUrl("menu/home")):0==s?(yield i.dismiss(),t.showAlert("Login failed","Please verify your email first!")):(yield i.dismiss(),t.showAlert("Login failed","Please check your credentials!"))})()}setOpen(t){this.isModalOpen=t}setClose(t){this.isModalOpen=t}setClose2(t){var n=this;return(0,p.Z)(function*(){n.isModalOpen=t;const i=yield n.loadingController.create();yield i.present(),n.router.navigateByUrl("reg"),yield i.dismiss()})()}openSignIn(){"web"===hh.dV.getPlatform()?this.signInWithAppleWeb():this.signInWithAppleNative()}signInWithAppleWeb(){var t=this;return(0,p.Z)(function*(){const n=new gn("apple.com");try{const i=yield function Ny(r,e,t){return Vu.apply(this,arguments)}(t.auth,n);t.updateUserData(i.user)}catch(i){console.error("Error signing in with Apple:",i)}})()}signInWithAppleNative(){var t=this;Yp.authorize({clientId:"com.ios.casa",redirectURI:"https://casa-android-c913e.firebaseapp.com/__/auth/handler",scopes:"email",state:"12345"}).then(function(){var i=(0,p.Z)(function*(s){const a=new gn("apple.com").credential({idToken:s.response.identityToken}),u=yield Ri(t.auth,a);t.updateUserData(u.user),yield t.storage.set("appleid",u.user.uid),yield t.storage.set("apple_email",u.user.email),t.storage.set("userState",!1),t.http.post("https://casa.evokemusic.net/api/login_api",{user_id:u.user.uid,email:u.user.email}).subscribe(c=>{console.log("Email for apple:",u.user.email),console.log("login api result :",c),t.apiService.setDocument(`users/${u.user.uid}`,{name:u.user.displayName,email:u.user.email,uid:u.user.uid,photo:u.user.photoURL}),t.setUserData(u.user.uid)}),t.router.navigateByUrl("menu/home")});return function(s){return i.apply(this,arguments)}}()).catch(i=>{console.log("error: ",i)})}setUserData(t){this._uid.next(t)}getUserData(t){var n=this;return(0,p.Z)(function*(){const i=yield n.apiService.getDocById(`users/${t}`);if(null!=i&&i.exists())return i.data();throw"No such docuent exists"})()}updateUserData(t){var n=this;return(0,p.Z)(function*(){const i=zd(n.firestore,`users/${t.uid}`);let s={email:t.email};try{yield function Up(r,e,t){r=M(r,ne);const n=M(r.firestore,j),i=function Wo(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}(r.converter,e,t);return ir(n,[qo(hn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,Q.none())])}(i,s,{merge:!0})}catch(o){console.error("Error updating user data:",o)}})()}logoutApple(){this.auth.signOut()}forgetPassword(){var t=this;return(0,p.Z)(function*(){const n=yield t.loadingController.create();t.isModalOpen=!1,yield n.present(),t.router.navigateByUrl("reset-password"),yield n.dismiss()})()}}return r.\u0275fac=function(t){return new(t||r)(y.Y36(wI.s),y.Y36(xi.F0),y.Y36(PI.K),y.Y36(Se.qu),y.Y36(re.HT),y.Y36(re.Br),y.Y36(bI.e),y.Y36(SI.eN),y.Y36(kI.gx),y.Y36(CI.gg))},r.\u0275cmp=y.Xpm({type:r,selectors:[["app-login"]],decls:25,vars:2,consts:[[3,"fullscreen"],[2,"margin-left","auto","margin-right","auto","position","relative","top","25%"],[2,"position","relative","margin-top","10%","margin-bottom","25%"],["alt","logo","id","header_logo","width","auto","src","../../assets/Casa_Connect_Logo.png"],[1,"abt"],["expand","block","shape","round",1,"color",2,"margin-left","10%","margin-right","10%",3,"click"],["name","logo-apple",2,"padding-right","0.6em"],[2,"font-size","x-small","font-weight","bold"],["color","danger","expand","block","shape","round",2,"margin-left","10%","margin-right","10%",3,"click"],["name","logo-google",2,"padding-right","0.6em"],["color","warning","expand","block","shape","round",2,"margin-left","10%","margin-right","10%",3,"click"],["name","mail",2,"padding-right","0.6em"],[3,"isOpen"],["slot","start"],[3,"click"],[1,"ion-padding"],["color","medium",2,"position","static"],[3,"formGroup","ngSubmit"],["fill","outline",1,"ion-margin-bottom",2,"border-radius","10px"],["type","email","placeholder","Official Email","formControlName","email"],["slot","error",4,"ngIf"],["type","password","placeholder","Password","formControlName","password"],["type","submit",2,"width","80px","height","40px",3,"disabled","click"],["fill","clear",3,"click"],["type","button",2,"width","80px","height","40px",3,"click"],["slot","error"]],template:function(t,n){1&t&&(y.TgZ(0,"ion-content",0)(1,"div",1)(2,"ion-title",2),y._UZ(3,"img",3),y.qZA(),y.TgZ(4,"ion-grid")(5,"ion-row",4)(6,"ion-col")(7,"ion-button",5),y.NdJ("click",function(){return n.openSignIn()}),y._UZ(8,"ion-icon",6),y.TgZ(9,"div",7),y._uU(10,"Sign In with Apple"),y.qZA()()()(),y.TgZ(11,"ion-row",4)(12,"ion-col")(13,"ion-button",8),y.NdJ("click",function(){return n.signIn()}),y._UZ(14,"ion-icon",9),y.TgZ(15,"div",7),y._uU(16,"Sign in with Google"),y.qZA()()()(),y.TgZ(17,"ion-row",4)(18,"ion-col")(19,"ion-button",10),y.NdJ("click",function(){return n.setOpen(!0)}),y._UZ(20,"ion-icon",11),y.TgZ(21,"div",7),y._uU(22,"Sign in with Email"),y.qZA()()()()()(),y.TgZ(23,"ion-modal",12),y.YNc(24,DI,25,4,"ng-template"),y.qZA()()),2&t&&(y.Q6J("fullscreen",!0),y.xp6(23),y.Q6J("isOpen",n.isModalOpen))},dependencies:[Yu.O5,Se._Y,Se.JJ,Se.JL,re.YG,re.Sm,re.PM,re.FN,re.wI,re.W2,re.jY,re.Gu,re.gu,re.pK,re.Ie,re.uN,re.Nd,re.wd,re.sr,re.ki,re.j9,Se.sg,Se.u],styles:["ion-button.color[_ngcontent-%COMP%]{--background: white;--color: black;--border-color: black;--border-style: solid}"]}),r})()}];let OI=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=y.oAB({type:r}),r.\u0275inj=y.cJS({imports:[xi.Bz.forChild(NI),xi.Bz]}),r})(),MI=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=y.oAB({type:r}),r.\u0275inj=y.cJS({imports:[Yu.ez,Se.u5,re.Pc,OI,Se.UX]}),r})()}}]);