"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2326],{2326:(j,f,a)=>{a.r(f),a.d(f,{ConnectPageModule:()=>G});var v=a(6814),P=a(95),r=a(7311),m=a(2129),g=a(5861),b=a(7398),Z=a(4664),S=a(2096),o=a(6689),T=a(7613),w=a(9862),U=a(2014),Y=a(1786),A=a(6882),z=a(1930);function J(t,u){if(1&t&&(o.TgZ(0,"ion-row")(1,"ion-col"),o._uU(2),o.qZA()()),2&t){const n=o.oxw();o.xp6(2),o.hij(" ",n.name," ")}}function Q(t,u){if(1&t&&(o.TgZ(0,"ion-row")(1,"ion-col"),o._uU(2),o.qZA()()),2&t){const n=o.oxw();o.xp6(2),o.hij(" ",n.company," ")}}function D(t,u){if(1&t&&(o.TgZ(0,"ion-row")(1,"ion-col"),o._uU(2),o.qZA()()),2&t){const n=o.oxw();o.xp6(2),o.hij(" ",n.telephone," ")}}function I(t,u){if(1&t&&(o.TgZ(0,"ion-row")(1,"ion-col"),o._uU(2),o.qZA()()),2&t){const n=o.oxw();o.xp6(2),o.hij(" ",n.email," ")}}function M(t,u){if(1&t){const n=o.EpF();o.TgZ(0,"ion-button",10),o.NdJ("click",function(){o.CHM(n);const i=o.oxw();return o.KtG(i.createConnection())}),o._uU(1," Connect "),o.qZA()}}function N(t,u){1&t&&(o.TgZ(0,"ion-button",11),o._uU(1," Connected "),o.qZA()),2&t&&o.Q6J("disabled",!0)}function F(t,u){if(1&t){const n=o.EpF();o.TgZ(0,"ion-button",12),o.NdJ("click",function(){o.CHM(n);const i=o.oxw();return o.KtG(i.startChat())}),o._uU(1," Messsage "),o.qZA()}}const R=[{path:"",component:(()=>{class t{constructor(n,e,i,l,c,d,s,h,p,C){this.api=n,this.loadingController=e,this.http=i,this.storage=l,this.router=c,this.chatService=d,this.route=s,this.navCtrl=h,this.auth=p,this.connectionService=C}ngOnInit(){var n=this;return(0,g.Z)(function*(){var e;const i=null===(e=n.router.getCurrentNavigation())||void 0===e?void 0:e.extras.state;if(console.log("data",i),null==i||!i.email)return void n.navCtrl.back();n.name=i.name,n.email=i.email,n.status=i.status;const l=null==i?void 0:i.id;var c,d;l?(n.id=l,n.gmailid=yield n.storage.get("gmailid"),n.gmailid?(n.getConnectedUsersForGoogle(),console.log("connnectionVerificationStatus",n.gmailid,n.id),n.http.post("https://casa.evokemusic.net/api/v1/connection_status",{user_id:n.gmailid,connection_id:n.id}).subscribe(s=>{n.connectionStatus=s,n.connectionVal="connected"==n.connectionStatus.status?1:0,console.log("Connection Status",s)},s=>{console.log("Error",s)})):(n.getConnectedUsers(),console.log("connnectionVerificationStatus",null===(c=n.auth.currentUser)||void 0===c?void 0:c.uid,n.id),n.http.post("https://casa.evokemusic.net/api/v1/connection_status",{user_id:null===(d=n.auth.currentUser)||void 0===d?void 0:d.uid,connection_id:n.id}).subscribe(s=>{n.connectionStatus=s,n.connectionVal="connected"==n.connectionStatus.status?1:0,console.log("Connection Status",s)},s=>{console.log("Error",s)}))):n.navCtrl.back()})()}createConnection(){var n=this;return(0,g.Z)(function*(){var e,i;n.gmailid?(console.log("createConnection",n.gmailid,n.id),n.http.post("https://casa.evokemusic.net/api/v1/user_connection",{user_id:n.gmailid,connection_id:n.id}).subscribe(function(){var l=(0,g.Z)(function*(c){var d;let s;if(console.log("Users connected",c),s=yield(yield n.api.getDocs("connectedUsers",n.api.whereQuery("members","in",[[n.id,n.gmailid],[n.gmailid,n.id]]))).docs.map(x=>{let y=x.data();return y.id=x.id,y}),(null===(d=s)||void 0===d?void 0:d.length)>0)return s[0];const p={members:[n.gmailid,n.id],type:"private",createdAt:new Date,updatedAt:new Date};return s=yield n.api.addDocument("connectedUsers",p),console.log("Connection Creating"),n.router.navigateByUrl("menu/network"),s});return function(c){return l.apply(this,arguments)}}(),l=>{console.log("Error",l)})):(console.log("createConnection",null===(e=n.auth.currentUser)||void 0===e?void 0:e.uid,n.id),n.http.post("https://casa.evokemusic.net/api/v1/user_connection",{user_id:null===(i=n.auth.currentUser)||void 0===i?void 0:i.uid,connection_id:n.id}).subscribe(l=>{console.log("Users connected",l);const c=n.connectionService.createConnection(n.id);console.log("Room: ",c),console.log("Connection Creating"),n.router.navigateByUrl("menu/network")},l=>{console.log("Error",l)}))})()}getConnectedUsers(){this.connectionService.getConnections(),this.connections=this.connectionService.connections}getConnectedUsersForGoogle(){this.connections=this.api.collectionDataQuery("connectedUsers",this.api.whereQuery("members","array-contains",this.gmailid)).pipe((0,b.U)(n=>(n.map(e=>{const i=e.members.filter(c=>c!=this.gmailid),l=this.api.docDataQuery(`users/${i[0]}`,!0);e.user=l}),console.log("getConnectedUsersForGoogle :",n),n)),(0,Z.w)(n=>(0,S.of)(n)))}startChat(){var n=this;return(0,g.Z)(function*(){if(n.gmailid){let e;const i=yield n.api.getDocs("chatRooms",n.api.whereQuery("members","in",[[n.id,n.gmailid],[n.gmailid,n.id]]));if(i.docs.length>0){const c=i.docs[0];e={id:c.id,...c.data()}}else{const c={members:[n.gmailid,n.id],type:"private",createdAt:new Date,updatedAt:new Date};yield n.api.addDocument("chatRooms",c)}n.router.navigate(["/","connect","chats",e.id],{queryParams:{name:n.name}}),console.log("room.id :",e.id)}else{const e=yield n.chatService.createChatRoom(n.id);n.router.navigate(["/","connect","chats",null==e?void 0:e.id],{queryParams:{name:n.name}})}})()}}return t.\u0275fac=function(n){return new(n||t)(o.Y36(T.s),o.Y36(r.HT),o.Y36(w.eN),o.Y36(U.K),o.Y36(m.F0),o.Y36(Y.a),o.Y36(m.gz),o.Y36(r.SH),o.Y36(A.gx),o.Y36(z.J))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-connect"]],decls:18,vars:9,consts:[[3,"translucent"],["slot","start"],["defaultHref","menu/network"],[3,"fullscreen"],[2,"margin-bottom","10px"],["src","../../assets/icon/6915987.png",2,"margin-top","20%","width","50px","float","left"],[4,"ngIf"],["style","font-size: small; margin-left: 40px; margin-bottom: 10px;","size","small","fill","outline",3,"click",4,"ngIf"],["style","font-size: small; margin-left: 40px; margin-bottom: 10px;","size","small","fill","outline",3,"disabled",4,"ngIf"],["style","font-size: small; margin-bottom: 10px; margin-right: 40px; float: right;","size","small",3,"click",4,"ngIf"],["size","small","fill","outline",2,"font-size","small","margin-left","40px","margin-bottom","10px",3,"click"],["size","small","fill","outline",2,"font-size","small","margin-left","40px","margin-bottom","10px",3,"disabled"],["size","small",2,"font-size","small","margin-bottom","10px","margin-right","40px","float","right",3,"click"]],template:function(n,e){1&n&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),o._UZ(3,"ion-back-button",2),o.qZA()()(),o.TgZ(4,"ion-content",3)(5,"ion-card")(6,"ion-card-content")(7,"ion-grid")(8,"ion-row",4)(9,"ion-col"),o._UZ(10,"img",5),o.qZA()(),o.YNc(11,J,3,1,"ion-row",6),o.YNc(12,Q,3,1,"ion-row",6),o.YNc(13,D,3,1,"ion-row",6),o.YNc(14,I,3,1,"ion-row",6),o.qZA()()(),o.YNc(15,M,2,0,"ion-button",7),o.YNc(16,N,2,1,"ion-button",8),o.YNc(17,F,2,0,"ion-button",9),o.qZA()),2&n&&(o.Q6J("translucent",!0),o.xp6(4),o.Q6J("fullscreen",!0),o.xp6(7),o.Q6J("ngIf",e.name),o.xp6(1),o.Q6J("ngIf",e.company),o.xp6(1),o.Q6J("ngIf",e.telephone),o.xp6(1),o.Q6J("ngIf",e.email),o.xp6(1),o.Q6J("ngIf",0==e.connectionVal&&0==e.status),o.xp6(1),o.Q6J("ngIf",1==e.connectionVal),o.xp6(1),o.Q6J("ngIf",1==e.connectionVal&&1==e.status))},dependencies:[v.O5,r.oU,r.YG,r.Sm,r.PM,r.FN,r.wI,r.W2,r.jY,r.Gu,r.Nd,r.sr,r.cs]}),t})()},{path:"chats/:id",loadChildren:()=>a.e(8479).then(a.bind(a,8479)).then(t=>t.ChatPageModule)}];let V=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[m.Bz.forChild(R),m.Bz]}),t})(),G=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[v.ez,P.u5,r.Pc,V]}),t})()}}]);